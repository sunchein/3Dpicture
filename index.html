<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>香氛人格 藝術創作平台</title>

    <!-- 移除了 html2pdf.js -->
    
    <style>
        /* --- 基礎樣式 --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #121212;
            color: #E0E0E0;
            margin: 0;
            padding: 0;
        }
        h2, h3 {
            border-bottom: 2px solid #444;
            padding-bottom: 8px;
            margin-top: 10px;
        }
        
        /* --- 主內容包裝 (預設隱藏) --- */
        #main-content {
            display: none; /* 預設隱藏 */
            justify-content: center;
            align-items: flex-start;
            padding: 20px;
            gap: 30px;
            flex-wrap: wrap;
        }
        
        /* --- 訪客登錄彈窗 --- */
        #user-info-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        #user-info-form {
            background-color: #1E1E1E;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.5);
            width: 400px;
            max-width: 90%;
        }
        #user-info-form h2 {
            text-align: center;
            margin-top: 0;
        }
        .form-field {
            margin-bottom: 20px;
        }
        .form-field label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #AAA;
        }
        .form-field input[type="text"],
        .form-field input[type="tel"] {
            width: 100%;
            padding: 12px;
            border-radius: 6px;
            border: 1px solid #555;
            background-color: #333;
            color: #E0E0E0;
            box-sizing: border-box;
            font-size: 1rem;
        }
        .form-field-radio {
            display: flex;
            gap: 20px;
        }
        .form-field-radio label {
            color: #E0E0E0;
            font-weight: normal;
        }
        #user-info-form button {
            background-color: #0D6EFD;
        }
        #user-info-form button:hover {
            background-color: #0A58CA;
        }


        /* --- 控制面板 --- */
        #controls {
            width: 400px;
            min-width: 320px;
            background-color: #1E1E1E;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.5);
        }
        .control-group { margin-bottom: 20px; }
        .control-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 0.9rem;
            color: #AAA;
        }
        select, input[type="range"] {
            width: 100%;
            padding: 8px;
            border-radius: 6px;
            border: 1px solid #555;
            background-color: #333;
            color: #E0E0E0;
            box-sizing: border-box;
        }
        input[type="range"] { padding: 0; }
        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .slider-value {
            font-weight: bold;
            font-size: 1rem;
            color: #FFF;
            min-width: 45px;
            text-align: right;
        }
        
        /* --- 按鈕樣式 --- */
        button {
            width: 100%;
            padding: 12px;
            font-size: 1.1rem;
            font-weight: bold;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: 10px;
        }
        button:disabled {
            background-color: #555;
            cursor: not-allowed;
            opacity: 0.7;
        }
        #generate-btn { background-color: #0D6EFD; }
        #generate-btn:hover:not(:disabled) { background-color: #0A58CA; }
        #tools-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        #screenshot-btn {
            grid-column: 1 / -1;
            background-color: #198754;
        }
        #screenshot-btn:hover:not(:disabled) { background-color: #157347; }
        #start-record-btn { background-color: #DC3545; }
        #start-record-btn:hover:not(:disabled) { background-color: #BB2D3B; }
        #stop-record-btn { background-color: #444; }
        #stop-record-btn:hover:not(:disabled) { background-color: #333; }
        .info-text {
            font-size: 0.9rem;
            color: #aaa;
            background-color: #2a2a2a;
            padding: 10px;
            border-radius: 6px;
            margin-top: 15px;
            line-height: 1.5;
        }
        .info-text a {
            color: #58a6ff;
            text-decoration: none;
        }
        .info-text a:hover {
            text-decoration: underline;
        }

        /* --- 藝術畫布 --- */
        #output-container {
            width: 500px;
            max-width: 90vw;
            background-color: #000;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0,0,0,0.5);
        }
        #art-canvas {
            aspect-ratio: 1 / 1;
            width: 100%;
            background-color: #000;
            display: block;
        }
        
        /* --- 洽詢表單樣式 --- */
        #inquiry-form textarea {
            width: 100%;
            height: 120px;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #555;
            background-color: #333;
            color: #E0E0E0;
            box-sizing: border-box;
            font-size: 1rem;
            font-family: inherit;
        }
        #inquiry-form button {
            background-color: #ff6a00;
        }
        #inquiry-form button:hover {
            background-color: #e05c00;
        }
        #inquiry-form input[type="text"],
        #inquiry-form input[type="tel"] {
             width: 100%;
            padding: 12px;
            border-radius: 6px;
            border: 1px solid #555;
            background-color: #333;
            color: #E0E0E0;
            box-sizing: border-box;
            font-size: 1rem;
        }
        
        /* --- 報告按鈕 --- */
        #report-btn {
            background-color: #ff6a00; /* 醒目的橘色 */
            grid-column: 1 / -1; /* 佔滿整行 */
        }
        #report-btn:hover:not(:disabled) {
            background-color: #e05c00;
        }
        
        /* 移除了 PDF 報告模板的 CSS */
        
    </style>
</head>
<body>

    <!-- 訪客登錄 Modal -->
    <div id="user-info-modal">
        <form id="user-info-form" name="visitor-login" data-netlify="true">
            <!-- Netlify 隱藏欄位 -->
            <input type="hidden" name="form-name" value="visitor-login" />
            
            <h2>香氛人格 藝術創作</h2>
            <div class="form-field">
                <label for="user-name">您的姓名</label>
                <input type="text" id="user-name" name="user-name" required>
            </div>
            <div class="form-field">
                <label for="user-phone">您的電話</label>
                <input type="tel" id="user-phone" name="user-phone" required>
            </div>
            <div class="form-field">
                <label>您的稱謂</label>
                <div class="form-field-radio">
                    <label><input type="radio" name="user-title" value="先生" checked> 先生</label>
                    <label><input type="radio" name="user-title" value="小姐"> 小姐</label>
                </div>
            </div>
            <button type="submit">開始創作</button>
        </form>
    </div>

    <!-- 主內容 (預設隱藏) -->
    <div id="main-content">
        <!-- ======== 控制面板 ======== -->
        <div id="controls">
            <h2>香氛人格設定</h2>
            <!-- 前/中/後調 (結構不變) -->
            <div class="control-group">
                <h3>前調 (Top Note)</h3>
                <select id="select-top" class="personality-select"></select>
                <div class="slider-container">
                    <input type="range" id="slider-top" class="percentage-slider" min="0" max="100" value="34">
                    <span id="value-top" class="slider-value">34%</span>
                </div>
            </div>
            <div class="control-group">
                <h3>中調 (Middle Note)</h3>
                <select id="select-mid" class="personality-select"></select>
                <div class="slider-container">
                    <input type="range" id="slider-mid" class="percentage-slider" min="0" max="100" value="33">
                    <span id="value-mid" class="slider-value">33%</span>
                </div>
            </div>
            <div class="control-group">
                <h3>後調 (Base Note)</h3>
                <select id="select-base" class="percentage-slider"></select>
                <div class="slider-container">
                    <input type="range" id="slider-base" class="percentage-slider" min="0" max="100" value="33">
                    <span id="value-base" class="slider-value">33%</span>
                </div>
            </div>
            
            <!-- 全域參數 (結構不變) -->
            <h2>全域參數</h2>
            <div class="control-group">
                <label for="slider-color">顏色強度 (Color Intensity)</label>
                <input type="range" id="slider-color" min="50" max="200" value="100">
            </div>
            <div class="control-group">
                <label for="slider-spray">噴霧濃度 (Spray Concentration)</label>
                <input type="range" id="slider-spray" min="10" max="50" value="25">
            </div>
            <div class="control-group">
                <label for="slider-halo">光暈強度 (Halo Intensity)</label>
                <input type="range" id="slider-halo" min="0" max="100" value="30">
            </div>
            
            <!-- 生成按鈕 -->
            <button id="generate-btn">生成香氛藝術創作</button>
            
            <!-- 創作工具 -->
            <h2 style="margin-top: 30px;">創作工具</h2>
            <div id="tools-container">
                <button id="start-record-btn">開始錄影</button>
                <button id="stop-record-btn">停止並儲存</button>
                <button id="screenshot-btn">截圖並儲存</button>
                <!-- 報告按鈕 -->
                <button id="report-btn">產生您的香氛人格報告</button>
            </div>
            <p id="recorder-info" class="info-text"></p>
            
            <!-- 服務洽詢表單 -->
            <h2 style="margin-top: 30px;">探索服務留言</h2>
            <form id="inquiry-form" name="service-inquiry" data-netlify="true">
                <!-- Netlify 隱藏欄位 -->
                <input type="hidden" name="form-name" value="service-inquiry" />
                
                <div class="form-field">
                    <label for="inquiry-name">您的姓名 (自動帶入)</label>
                    <input type="text" id="inquiry-name" name="inquiry-name" readonly>
                </div>
                <div class="form-field">
                    <label for="inquiry-phone">您的電話 (自動帶入)</label>
                    <input type="tel" id="inquiry-phone" name="inquiry-phone" readonly>
                </div>
                 <div class="form-field">
                    <label>您的稱謂 (自動帶入)</label>
                    <div class="form-field-radio" id="inquiry-title-container"></div>
                </div>
                <div class="form-field">
                    <label for="inquiry-message">您的留言</label>
                    <textarea id="inquiry-message" name="inquiry-message" placeholder="我想進一步了解..." required></textarea>
                </div>
                <button type="submit">送出洽詢</button>
            </form>
            
        </div>

        <!-- ======== 藝術畫布 (不變) ======== -->
        <div id="output-container">
            <canvas id="art-canvas"></canvas>
        </div>
    </div>
    
    <!-- 背景音樂播放器 -->
    <audio id="bg-music" loop></audio>

    <!-- 移除了 PDF 報告模板的 div -->

    <script>
        // ======== 1. 資料庫 (不變) ========
        const personalityData = [
            { id: "leader", name: "01 領導者 (Leader)", color: "#FF0000", musicUrl: "music/01.mp3" },
            { id: "collaborator", name: "02 合作者 (Collaborator)", color: "#FF6200", musicUrl: "music/02.mp3" },
            { id: "creator", name: "03 創意者 (Creator)", color: "#FFB005", musicUrl: "music/03.mp3" },
            { id: "implementer", name: "04 實踐者 (Implementer)", color: "#489103", musicUrl: "music/04.mp3" },
            { id: "adventurer", name: "05 冒險者 (Adventurer)", color: "#0559AD", musicUrl: "music/05.mp3" },
            { id: "guardian", name: "06 守護者 (Guardian)", color: "#1E0369", musicUrl: "music/06.mp3" },
            { id: "explorer", name: "07 探索者 (Explorer)", color: "#650280", musicUrl: "music/07.mp3" },
            { id: "achiever", name: "08 成就者 (Achiever)", color: "#DE8909", musicUrl: "music/08.mp3" },
            { id: "idealist", name: "09 理想者 (Idealist)", color: "#FAE171", musicUrl: "music/09.mp3" },
            { id: "inspirator", name: "10 靈感者 (Inspirator)", color: "#E3E4E6", musicUrl: "music/10.mp3" },
            { id: "architect", name: "11 建築大師 (Architect)", color: "#692C00", musicUrl: "music/11.mp3" },
            { id: "mentor", name: "12 靈魂導師 (Soul Mentor)", color: "#FFFACD", musicUrl: "music/12.mp3" }
        ];

        /*
         * ======================================================================
         * 【深度 AI 分析資料庫】(不變)
         * ======================================================================
        */
        const personalityInsights = {
            "leader": {
                title: "01 領導者 (Leader)",
                tagline: "我是我命運的主宰，我意志的顯化者。",
                analysis: [
                    { 
                        title: "核心優勢：決斷的意志力",
                        content: "領導者的核心力量，來自於一種與生俱來的、不容置疑的內在權威。您如同站在山巔的鷹，擁有最清晰的視野和最果斷的行動力。您不懼怕做出艱難的決定，並且有能力承擔決策帶來的後果。這種特質使您在混亂中成為他人的燈塔，一個天生的指引者。您的能量是聚焦的、強大的、向前的，如同木質辛香調般，既沉穩又充滿灼熱的穿透力。在團體中，您會很自然地承擔起責任，組織架構，並推動事務前進。您不喜歡模糊不清的狀態，而是傾向於創造秩序和方向。這種果斷的特質，是您贈與世界最寶貴的禮物，您能將願景化為現實，將不可能變為可能。"
                    },
                    { 
                        title: "深度課題：控制與臣服",
                        content: "然而，領導者最大的陰影，來自於您對「失控」的極度恐懼。當您處於低頻狀態時，您的「領導力」會質變為「控制欲」。您可能會變得強勢、獨斷，聽不進他人的意見，只相信自己的判斷。您害怕示弱，因為在您的潛意識中，「軟弱」等於「失敗」。這股恐懼會讓您變得緊繃，難以放鬆，也讓身邊的人倍感壓力。您的課題在於學習「臣服」——這並非放棄，而是去相信宇宙有更大的流動，去信任您的團隊，去接納事情有時會偏離您的完美計畫。您必須學會，真正的力量不是來自於緊抓不放，而是來自於在變動中依然能保持中心的平靜。"
                    },
                    { 
                        title: "靈性揚升之路：從「君王」到「啟發者」",
                        content: "您的靈性揚升之路，在於學會「以愛領導，而非以恐懼」。您需要從一個發號施令的「君王」，轉化為一個啟發他人潛能的「引導者」。這需要您發展您的陰性特質：同理心、傾聽與包容力。\
                        香氛藝術對您的幫助極大。您在創作時，可以有意識地使用您所缺乏的能量色彩。例如，當您感受到自己過於剛硬時，嘗試融入「合作者」的溫暖橙曦色，或是「理想者」的柔和月光色。在您強勁有力的筆觸中，刻意練習加入一些流動的、柔和的曲線。\
                        這個過程是在提醒您，力量與溫柔可以並存。您越是能包容不同的聲音，您的領導就越是穩固。當您不再需要透過控制來證明自己的價值時，您就解鎖了「領導者」的最高潛能：成為一個空性的管道，讓更大的智慧透過您來指引眾人。您的療癒真言是：『我信任生命的流動，我以愛與智慧引領方向。』"
                    },
                    {
                        title: "事業與情感",
                        content: "在事業上，您是天生的管理者、創業者、執行長或任何需要決策的角色。您在壓力下表現出色，是危機處理的專家。但您需要一個能「說真話」的副手，來平衡您可能的盲點。在情感關係中，您是主導者和保護者。您渴望穩定且忠誠的關係，並會為伴侶扛起許多責任。然而，您也必須給予伴侶足夠的空間，避免將「愛」變成了「安排」。學會展現您脆弱的一面，是您在關係中深化親密感的關鍵。"
                    }
                ]
            },
            // ... (其他 11 個人格的深度分析內容，與上一版完全相同，此處省略以節省篇幅) ...
             "collaborator": {
                title: "02 合作者 (Collaborator)",
                tagline: "我是一切的連結，我在和諧中看見力量。",
                analysis: [
                    { title: "核心優勢：溫和的包容力", content: "合作者的核心天賦，在於您那如同春日暖陽般的包容力與同理心。您是群體中的「和諧締造者」，天生就懂得如何化解衝突，連結不同的個體。您的存在本身就是一種療癒，能讓緊繃的人放鬆，讓封閉的心敞開。您的能量是擴散的、溫暖的、環繞的，如同白花麝香調般，既潔淨又充滿溫柔的包容性。您不追求個人的突出，而是享受團隊共創的成果。您擅長傾聽，能敏銳地察覺他人的需求與情緒，並總是願意伸出援手。這種無私的奉獻精神，使您成為最值得信賴的夥伴、朋友與家人。" },
                    { title: "深度課題：邊界與自我", content: "然而，合作者最大的挑戰，在於您「自我邊界」的模糊。由於您能深刻地感受到他人的情緒，您時常會將他人的課題當成自己的責任，背負了過多的情緒包袱。您害怕衝突，為了維持表面的和諧，您會習慣性地壓抑自己的真實感受與需求，甚至犧牲自己的利益。您的課題在於學習「在慈悲中設立界線」。您必須明白，過度的付出是一種消耗，而非滋養。您需要找回自己的聲音，勇敢地說「不」，並相信真正的和諧，是建立在每個人（包含您自己）都被尊重與滿足的基礎上。" },
                    { title: "靈性揚升之路：從「附和」到「共創」", content: "您的靈性揚升之路，在於肯定「自我價值」。您不需要透過滿足他人來證明自己值得被愛。您的存在本身就已圓滿。\
                        香氛藝術對您而言，是一個絕佳的「自我表達」練習。您可以在創作中，大膽地使用那些您平時可能迴避的、強烈的人格特質。例如，嘗試加入「領導者」的赤紅色木質調，感受那股決斷的力量；或者引入「成就者」的鎏金色，在畫布上宣告您的存在。這並非要您變得強勢，而是要在您的溫和中，注入一股「堅定」的力量。\
                        練習在創作時，問問自己：「我真正想要的是什麼？」而不是「別人會喜歡什麼？」。當您學會了在不傷害他人的前提下，優先照顧自己的感受時，您就從一個被動的「附和者」，昇華為一個積極的「共創者」。您的療癒真言是：『我無條件地愛自己，我的需求和他人的一樣重要。』" },
                    { title: "事業與情感", content: "在事業上，您是完美的人力資源、諮商師、教師、護理人員或任何需要高度人際協調的職位。您是團隊中不可或缺的潤滑劑。但您必須學會爭取自己的權益，您的貢獻值得被看見與獎勵。在情感關係中，您是溫柔的傾聽者和照顧者。您能提供伴侶極大的情緒價值。但您也需要一個能反過來「照顧您」的伴侶，而不是一個持續消耗您的人。學會「索取」與「接受」，是您在關係中平衡的關鍵。" }
                ]
            },
            "creator": {
                title: "03 創意者 (Creator)",
                tagline: "我是無限的可能，我為世界帶來新奇。",
                analysis: [
                    { title: "核心優勢：靈動的藝術性", content: "創意者的核心本質，是「無限的可能性」。您是點子的泉源，您的思維如同在空中飛舞的蝴蝶，輕盈、靈巧且不受任何框架束縛。您擁有一雙能「看見美」的眼睛，能從最平凡的事物中發掘出獨特的趣味與藝術性。您的能量是躍動的、閃爍的、自由的，如同柑橘花香調般，明亮、愉悅且充滿驚喜。您熱愛新鮮感，厭惡一成不變。對您而言，生活本身就是一場藝術創作。您的使命，就是透過您的靈感，為這個世界注入新的色彩與活力，啟發他人跳脫僵化的思維。" },
                    { title: "深度課題：紀律與完成", content: "然而，創意者最大的困境，在於「落地生根」。您擁有 100 個絕妙的點子，卻可能只完成了 1 個。您對「過程」的熱愛遠大於對「結果」的執著，這使您容易在事物變得「無聊」（即需要執行紀律）時便轉身離開。您害怕承諾與規範，因為您認為那會扼殺您的靈感。您的課題在於學習「在紀律中保持自由」。您必須體認到，靈感只是 1%，另外 99% 的執行力，才是將夢想變為現實的橋樑。您需要的是「完成」的滿足感，而不只是「開始」的新鮮感。" },
                    { title: "靈性揚升之路：從「夢想家」到「創造者」", content: "您的靈性揚升之路，在於成為「靈感的實踐者」。您需要為您飛揚的能量，找到一個穩固的容器。\
                        香氛藝術是您的天賦所在，但您可以用它來練習「完成」。在創作時，您可以引入「實踐者」的翠岩色柑苔調，感受那股穩定務實的能量；或者加入「建築大師」的大地色，為您的創作設定一個清晰的結構與框架。例如，給自己一個挑戰：「在 30 分鐘內完成這幅創作，並且不再修改。」\
                        這個練習是在幫助您駕馭您的靈感，而非被靈感牽著鼻子走。當您學會了為您的創意服務，並有紀律地將其呈現出來時，您就不再只是一個「夢想家」，而是昇華為一個真正能改變世界的「創造者」。您的療癒真言是：『我珍視我的靈感，並給予它實現所需的時間與結構。』" },
                    { title: "事業與情感", content: "在事業上，您是天生的藝術家、設計師、行銷企劃、發明家。任何需要「從 0 到 1」的工作都適合您。但您不適合從事高度重複性的行政工作。您需要一個能幫您「收尾」的夥伴。在情感關係中，您是迷人且有趣的伴侶，總能帶來驚喜。但您也可能顯得不夠穩定，讓伴侶缺乏安全感。您需要學習，真正的「自由」是在一段承諾的關係中，依然能保有「心靈的自由」，而不是形式上的不受束縛。" }
                ]
            },
             "implementer": {
                title: "04 實踐者 (Implementer)",
                tagline: "我腳踏實地，我讓願景得以實現。",
                analysis: [
                    { title: "核心優勢：堅毅的耐力", content: "實踐者的核心價值，在於您那無與倫比的「堅毅」與「耐力」。您是大地之子，務實、穩定且極度可靠。與「創意者」相反，您是那個能將 1% 的靈感轉化為 99% 成果的人。您的能量是沉穩的、持續的、向下紮根的，如同木質芳香-柑苔調般，散發著大地與森林的厚實氣息。您不畏懼繁瑣的細節，反而能在重複的工作中找到秩序與平靜。您是天生的執行者，一步一腳印，緩慢但堅定地走向目標。您是所有偉大計畫背後，那個不可或缺的穩定力量。" },
                    { title: "深度課題：固執與彈性", content: "然而，實踐者最大的障礙，來自於您對「既定流程」的過度依賴。您相信「行之有效」的方法，這使您在面對變化時顯得抗拒與固執。您害怕「錯誤」，因此不願輕易嘗試新的路徑，即使舊的路徑已經效率不彰。您的務實有時會變為「僵化」，限制了您的視野。您的課題在於學習「擁抱彈性」。您必須理解，穩定並不等於一成不變。有時候，打破規則是為了建立一個更有效率的新秩序。" },
                    { title: "靈性揚升之路：從「工匠」到「大地的應變者」", content: "您的靈性揚升之路，在於在您的「穩定」中，注入「流動」的能量。您不需要拋棄您的務實，而是要讓您的務實變得更「聰明」。\
                        香氛藝術能幫助您打開感官。在創作時，請您刻意使用那些您不熟悉的人格特質。例如，大量使用「冒險者」的奔放蒼穹色，感受那股跳脫常規的活力；或者嘗試「創意者」的隨機性，允許自己在畫布上「犯錯」，看看會產生什麼意想不到的效果。\
                        這個練習能拓展您的舒適圈，讓您學會欣賞「變動」中的美感。當您能在變局中依然保持內在的平靜，並靈活地調整您的步伐時，您就從一個「埋頭苦幹的工匠」，昇華為一個「順應天時的大地應變者」。您的療癒真言是：『我根植大地，並隨生命的節奏靈活舞動。』" },
                    { title: "事業與情感", content: "在事業上，您是卓越的專案經理、工程師、會計師、工藝家或任何需要高度專注與執行力的工作。您是組織中最可靠的支柱。但您需要適時地抬起頭，看看大方向，避免「為了做而做」。在情感關係中，您是能提供「具體承諾」的伴侶。您不擅長甜言蜜語，但您會用「行動」來證明您的愛，例如準時回家、打理好一切。您需要一個能欣賞您這份「穩定」的伴侶，同時也能帶領您體驗生活中的不同樂趣。" }
                ]
            },
            "adventurer": {
                title: "05 冒險者 (Adventurer)",
                tagline: "世界是我的遊樂場，我擁抱未知。",
                analysis: [
                    { title: "核心優勢：奔放的勇氣", content: "冒險者的核心能量，是「對生命的全然好奇」。您是天生的探險家，勇敢、熱情、且永遠在路上。您不懼怕未知，反而對新事物充滿了難以抑制的興奮感。您的靈魂渴望「體驗」勝過一切。您的能量是快速的、流線型的、向外探索的，如同清新的木質調，帶著山頂的風與海洋的氣息。您是團體中的「催化劑」，總能帶來新的刺激，打破沉悶的僵局。您活在當下，享受每一個感官帶來的衝擊。您的存在，就是在提醒人們：生命是一場值得盡情玩樂的旅程。" },
                    { title: "深度課題：承諾與深度", content: "然而，冒險者最大的陷阱，在於您對「束縛」的恐懼。您如此熱愛自由，以至於任何形式的「承諾」——無論是工作、關係或是一個長期的計畫——在您看來都像是牢籠。您擅長「開始」，卻拙於「維繫」。您不斷追逐下一個刺激，這可能導致您的生命經驗雖然「廣」，卻不夠「深」。您的課題在於學習「在承諾中找到自由」。您必須體認到，真正的自由不是隨心所欲，而是在您所選擇的道路上，依然能感受到心靈的無限寬廣。" },
                    { title: "靈性揚升之路：從「漂泊者」到「智慧的旅人」", content: "您的靈性揚升之路，在於將您的「體驗」轉化為「智慧」。您需要學會在奔騰的能量中，找到一個「定錨點」。\
                        香氛藝術對您而言，是一個「靜心」的練習。在創作時，您可以引入「守護者」的靛藍色草本調，感受那股忠誠與安定的能量；或者加入「實踐者」的厚實大地色，練習在畫布的「方寸之間」深入探索，而不是總想著外面的世界。\
                        這個練習是在幫助您「向內探索」，而非一味「向外追尋」。當您學會了在一段關係、一份工作中深入耕耘，並從中發掘出源源不絕的樂趣時，您就將您外放的能量轉化為了內在的智慧。您從一個「隨波逐流的漂泊者」，昇華為一個「體驗生命深度的智慧旅人」。您的療癒真言是：『我在當下的承諾中，找到了最真實的自由與喜悅。』" },
                    { title: "事業與情感", content: "在事業上，您適合成為旅遊家、記者、運動員、銷售冠軍，或是任何充滿變化與挑戰性的工作。一成不變的辦公室工作會讓您窒息。您需要彈性的工時與不斷的新目標。在情感關係中，您是熱情如火的伴侶，與您在一起絕不無聊。但您也需要一個能理解並給予您極大空間的伴侶。您需要學習，真正的「親密」需要時間的沉澱，它所帶來的深度連結，遠比短暫的激情更為動人。" }
                ]
            },
            "guardian": {
                title: "06 守護者 (Guardian)",
                tagline: "我守護我所愛，我帶來安定。",
                analysis: [
                    { title: "核心優勢：忠誠的守護", content: "守護者的核心價值，在於您那堅定不移的「忠誠」與「責任感」。您是天生的保護者，如同城牆般可靠，為您所愛的人事物提供一個安全的避風港。您重視傳統、家庭與秩序，並會盡一切努力來維持這份「安定」。您的能量是防禦性的、穩固的、恆定的，如同草本花香木質調，散發著令人安心的氣息。您不是最耀眼的，卻是所有人最依賴的。您信守承諾，值得被託付重任。您的存在，為這個變動的世界帶來了最稀缺的「安全感」。" },
                    { title: "深度課題：焦慮與信任", content: "然而，守護者最大的束縛，來自於您對「失序」的深層焦慮。您強烈的保護欲，其根源往往是對「未知危險」的恐懼。這可能使您變得多疑、保守，甚至抗拒一切可能破壞現狀的「改變」。您為了「防範未然」，而活在一種持續的緊繃中，難以真正放鬆。您的課題在於學習「信任生命」。您必須放下「一切都必須在掌控之中」的執著，並相信即使改變發生，您和您所愛的人依然有能力應對。" },
                    { title: "靈性揚升之路：從「防衛者」到「祝福的守望者」", content: "您的靈性揚升之路，在於將您的「擔憂」轉化為「祝福」。您需要從一個時時防衛的「守衛」，轉化為一個給予信任與空間的「守望者」。\
                        香氛藝術能幫助您釋放壓抑的情緒。在創作時，請您刻意嘗試那些「失控」的技法。例如，使用「創意者」的金光色進行流體藝術，看著色彩自由流動，不加干預；或者引入「冒險者」的奔放線條，允許自己「畫出界線」。\
                        這個練習是在幫助您放下「必須完美」的壓力，學會欣賞混亂中的秩序。當您不再試圖控制一切，而是選擇用祝福與信任的眼光去看待未來時，您就釋放了自己與他人。您從「焦慮的防衛者」，昇華為「傳遞平靜與祝福的守望者」。您的療癒真言是：『我信任宇宙的安排，我所守護的一切都在愛中安然無恙。』" },
                    { title: "事業與情感", content: "在事業上，您是完美的公務員、軍警、保險從業員、教師或任何需要高度穩定性與責任感的職業。您是組織的基石。但您需要避免變得僵化，應適時接受新的系統與工具。在情感關係中，您是最忠誠、最顧家的伴侶。您會將家庭打理得井井有條，提供伴侶最強大的後盾。但您也需要避免將「關心」變成「嘮叨」，學習給予伴侶「犯錯」的空間，這會讓您的關係更輕鬆自在。" }
                ]
            },
            "explorer": {
                title: "07 探索者 (Explorer)",
                tagline: "我探索內在，我追尋萬物的真理。",
                analysis: [
                    { title: "核心優勢：深層的洞察力", content: "探索者的核心特質，在於您對「表象之下」的真理有著近乎本能的渴求。您是靈魂的考古學家，神秘、獨立、且極具洞察力。您不滿足於世俗的答案，而是致力於探索內在宇宙、靈性奧秘與生命的終極意義。您的能量是向內收斂的、渦旋的、深沉的，如同樹脂木質調，帶著古老智慧的沉靜香氣。您享受獨處，因為獨處是您與宇宙連結的途徑。您能輕易看穿事物的本質，您的存在，就是在提醒人們：生命不只有物質層面，更有無限深邃的精神維度。" },
                    { title: "深度課題：入世與連結", content: "然而，探索者最大的挑戰，在於「與現實世界的連結」。您如此沉浸在自己的內在世界，以至於有時會與現實生活「脫節」。您可能顯得孤高、不善社交，或對柴米油鹽的俗事感到不耐。您害怕膚淺的人際互動會干擾您的「頻率」。您的課題在於學習「在人間修行」。您必須體認到，最深刻的靈性體悟，往往就隱藏在最平凡的人際互動與日常瑣事中。逃離人群並不能讓您開悟，真正的開悟是「帶著覺知」走入人群。" },
                    { title: "靈性揚升之路：從「隱士」到「入世的智者」", content: "您的靈性揚升之路，在於將您的「洞察」轉化為「服務」。您需要從一個離群索居的「隱士」，轉化為一個將智慧帶入人群的「智者」。\
                        香氛藝術是您將內在世界「具象化」的絕佳工具。在創作時，您可以有意識地加入「合作者」的溫暖橙曦色，練習將您的深奧體悟，用「溫暖」的方式表達出來；或者引入「實踐者」的務實大地色，思考如何將您的靈性洞察「應用」在解決實際問題上。\
                        這個練習是在幫助您搭建「出世」與「入世」的橋樑。當您學會用平凡的語言分享不凡的真理，用您的洞察力去療癒他人時，您就將您的靈性變成了對世界的具體貢獻。您從「孤高的追尋者」，昇華為「在人間行走的智慧導師」。您的療癒真言是：『我紮根大地，我將內在的智慧，以愛與慈悲分享給世界。』" },
                    { title: "事業與情感", content: "在事業上，您是天生的心理學家、哲學家、研究員、作家、心靈導師。您適合任何需要深度思考與獨處的工作。您不適合從事快節奏、高壓的銷售或公關工作。在情感關係中，您渴望「靈魂伴侶」——一個能與您進行深度精神交流的人。您不重視物質，但極度重視「共鳴」。您需要一個尊重您獨處空間的伴侶。同時，您也必須學習「走出來」，主動參與伴侶的生活，而不只是期待對方來「懂」您。" }
                ]
            },
            "achiever": {
                title: "08 成就者 (Achiever)",
                tagline: "我鎖定目標，我享受達成的榮耀。",
                analysis: [
                    { title: "核心優勢：高效的驅動力", content: "成就者的核心能量，是「目標導向」的強大驅動力。您是天生的實幹家，充滿活力、效率驚人且極度專注。您享受「將事情完成」(Get Things Done) 的快感，並能為此付出巨大的努力。您的能量是聚焦的、燃燒的、直線前進的，如同木質草本辛香調，既清新又充滿了振奮人心的力量。您擅長將大目標拆解為小步驟，並逐一擊破。您是自我激勵的典範，您的存在，就是在示範人類的潛能可以透過「專注」與「行動」被激發到何種程度。" },
                    { title: "深度課題：過程與價值", content: "然而，成就者最大的陷阱，在於將「自我價值」與「外在成就」完全劃上等號。您如此專注於「下一個目標」，以至於無法享受「當下」的過程。您總是在奔跑，一旦停下來，就會被「不夠好」的焦慮所吞噬。您害怕「虛度光陰」，因此把自己的行程排得密不透風，卻犧牲了健康、關係與內在的平靜。您的課題在於學習「無所事事的價值」。您必須明白，您的價值不是來自於您「做了什麼」，而是來自於您「是誰」。" },
                    { title: "靈性揚升之路：從「逐浪者」到「享受當下的實踐家」", content: "您的靈性揚升之路，在於從「人類實幹」(Human Doing) 轉變為「人類存在」(Human Being)。您需要學會在高效的行動中，注入「放鬆」與「享受」的品質。\
                        香氛藝術對您而言，是一個「無關乎成就」的純粹體驗。在創作時，請您刻意放下「要畫得多好」的企圖。嘗試引入「理想者」的浪漫月光色，單純地享受色彩的流動；或者使用「靈魂導師」的聖光色東方調，在創作中進行「動態靜心」。\
                        這個練習是在幫助您找回「過程」的樂趣。當您學會了在不為任何目的的情況下，依然能全情投入，您就找到了內在的平衡。您從一個「追逐成就的焦慮者」，昇華為一個「享受生命每一刻的豐盛實踐家」。您的療癒真言是：『我的價值與生俱來。我允許自己全然地放鬆，並享受當下的豐盛。』" },
                    { title: "事業與情感", content: "在事業上,您是頂尖的業務、企業家、專案領袖、運動員。您在有明確目標與獎勵的環境中表現最好。您是結果導向的。但您必須避免「贏了面子,輸了裡子」,要多關心團隊成員的情緒。在情感關係中,您會用「創造更好的物質生活」來表達愛。您是可靠的。但您也需要學習「放下手機」,專心地陪伴伴侶,提供「情緒價值」,而不只是「物質價值」。" }
                ]
            },
            "idealist": {
                title: "09 理想者 (Idealist)",
                tagline: "我相信世界的美好，我活在愛與光中。",
                analysis: [
                    { title: "核心優勢：純粹的信念", content: "理想者的核心本質，是「對美好的堅定信念」。您是行走在人間的天使，浪漫、純粹、且富有極強的同情心。您真心相信人性的善良，並渴望將這份愛與光傳播給周圍的每一個人。您的能量是輕盈的、療癒的、充滿希望的，如同花香柑苔調，散發著雨後清晨般的純淨氣息。您擁有一顆柔軟的心，能敏銳地感知到他人的痛苦，並給予最無私的安慰。您的存在，就是在提醒這個世界，無論現實多麼殘酷，永遠都不要放棄對「愛」與「美好」的嚮往。" },
                    { title: "深度課題：幻滅與現實", content: "然而，理想者最大的痛苦，來自於「現實與理想的巨大落差」。您對世界有著近乎天真的「粉紅色濾鏡」，當您被迫面對人性的黑暗、自私與現實的殘酷時，您會感到極度的幻滅、受傷，甚至選擇「逃避」。您容易將人事物過度美化，導致在關係中不斷失望。您的課題在於學習「接納現實，而不失去理想」。您必須體認到，這個世界是黑白共存的，接納黑暗，並不是對理想的背叛，而是為了讓您的光芒能更務實地照亮黑暗。" },
                    { title: "靈性揚升之路：從「天真」到「務實的慈悲」", content: "您的靈性揚升之路，在於將您的「慈悲心」轉化為「有效的行動」。您需要從一個「容易受傷的夢想家」，轉化為一個「腳踏實地的療癒者」。\
                        香氛藝術是您表達內在美好的管道。在創作時，您可以有意識地加入「實踐者」的務實翠岩色，思考如何將您的「關懷」轉化為「具體幫助」；或者引入「建築大師」的結構大地色，為您的「慈善計畫」建立一個可執行的方案。\
                        這個練習是在幫助您的「愛」找到紮根的土壤。當您學會了在看清現實的殘酷後，依然選擇保持善良，並用「務實」的行動去創造改變時，您的「理想」才真正擁有了力量。您從「天真的空想家」，昇華為「在人間創造天堂的行動療癒者」。您的療癒真言是：『我接納世界的所有樣貌，並選擇成為那個帶來改變的光。』" },
                    { title: "事業與情感", content: "在事業上，您是傑出的慈善工作者、社工、療癒師、藝術家、幼教老師。您適合從事能「給予愛」的工作。您不適合在高度競爭、爾虞我詐的商業環境中。在情感關係中，您是極度浪漫且付出的伴侶。您渴望童話般的愛情。但也因此容易受傷。您需要一個能「保護」您這份純真的伴侶，同時您也必須學習看清對方的「真實樣貌」，而不只是您「想像」中的他。" }
                ]
            },
            "inspirator": {
                title: "10 靈感者 (Inspirator)",
                tagline: "我是宇宙的管道，我傳遞啟示。",
                analysis: [
                    { title: "核心優勢：靈性的連結", content: "靈感者的核心天賦，在於您是一個「靈性的管道」。您天生就與高維度的智慧保持著連結，敏銳、直覺力強，並且總能接收到超越邏輯的「洞見」與「啟示」。您的能量是擴展的、無邊界的、向上升騰的，如同麝香琥珀東方調，既神秘又深遠，能觸動他人的靈魂深處。您如同燈塔，不一定需要做什麼，您的存在本身就能「啟發」他人，為迷茫的人帶來新的觀點與方向。您是天生的傳訊者、藝術家與療癒者。" },
                    { title: "深度課題：紮根與接地", content: "然而，靈感者最大的挑戰，在於「活在物質世界」。您時常「飄在空中」，沉浸在冥想、靈感或高頻的能量中，卻可能忽略了「身體」的需求與「現實」的瑣事。您可能顯得不切實際、健忘、缺乏行動力，或是難以處理金錢、帳單等俗務。您的課題在於學習「靈性紮根」(Spiritual Grounding)。您必須明白，靈魂選擇來到地球，就是為了體驗物質實相。逃離物質並不能讓您更靈性，真正的靈性是「在物質中活出神性」。" },
                    { title: "靈性揚升之路：從「傳訊者」到「活在當下的導師」", content: "您的靈性揚升之路，在於將您「接收」到的高維靈感，「實踐」在此時此地。您需要將天與地的能量在您心中整合。\
                        香氛藝術對您而言，是「接地」的絕佳練習。在創作時，請您刻意使用「實踐者」的翠岩色，感受大地的穩定；或者大量運用「建築大師」的大地色系，在創作中觀想自己「能量紮根」。您也可以在創作時，同時進行赤腳踩地、擁抱大樹等練習。\
                        這個練習是在幫助您穩固您的能量場。當您學會了在保持高頻連結的同時，也能清晰地處理日常事務、照顧好身體時，您就達成了「天人合一」。您從一個「飄忽的傳訊者」，昇華為一個「將天堂帶到人間的靈性導師」。您的療癒真言是：『我紮根於大地母親，我在此時此地，完整地展現我的靈魂之光。』" },
                    { title: "事業與情感", content: "在事業上，您是傑出的藝術家、音樂家、作家、靈性導師、占卜師、療癒師。您需要一個能讓您「靈感自由流動」的工作。您不適合在僵化、官僚的體系中。在情感關係中，您渴望的是「靈魂層次」的連結。您是柏拉圖式的戀人。但您也必須學習「務實」的相處，例如一起分擔家務、討論財務。一個能幫您處理俗務，同時又景仰您靈性的伴侶，是您的最佳搭檔。" }
                ]
            },
            "architect": {
                title: "11 建築大師 (Architect)",
                tagline: "我建立秩序，我讓系統得以長存。",
                analysis: [
                    { title: "核心優勢：宏觀的結構力", content: "建築大師的核心力量，在於您那強大的「系統思考」與「建構能力」。您是秩序的創造者，重視結構、邏輯與長遠的規劃。您擅長從一片混沌中，理出清晰的脈絡，並建立起穩固、高效、可長久運行的系統。您的能量是建構性的、穩固的、有組織的，如同綠意柑苔調，既有生命力又紮實可靠。您是天生的策略家與規劃者，思考宏觀，著手務實。您不只是「實踐者」的執行，更是「領導者」的規劃。您的存在，是文明與組織得以穩固發展的基石。" },
                    { title: "深度課題：僵化與流動", content: "然而，建築大師最大的侷限，在於您對「系統」的過度依賴。您如此熱愛您所建立的秩序與規則，以至於當「例外」或「混亂」出現時，您會感到焦慮，並試圖壓制它。您害怕「情感」的流動，因為它在您看來是「非理性」且「破壞系統」的。這可能使您變得僵化、缺乏人情味，或壓抑了自己與他人的創意。您的課題在於學習「在系統中保留彈性」。您必須體認到，系統是為「人」服務的，而非相反。一個沒有流動的系統，最終只會崩塌。" },
                    { title: "靈性揚升之路：從「規範者」到「會呼吸的創造者」", content: "您的靈性揚升之路，在於為您完美的「結構」，注入「生命」的氣息。您需要從一個冰冷的「規範者」，轉化為一個能欣賞「有機生長」的宏觀創造者。\
                        香氛藝術是您練習「擁抱混亂」的道場。在創作時，請您刻意放下您對「完美線條」的執著。嘗試使用「創意者」的自由金光色，允許色彩在畫布上自由融合；或者引入「理想者」的柔和月光色，專注於「感受」而非「思考」。\
                        這個練習是在幫助您打開您的右腦，接納「非邏輯」的美感。當您學會了在您建立的穩固框架中，保留「彈性」與「人性」的空間時，您的系統才真正擁有了生命力。您從「秩序的維護者」，昇華為「創造豐盛生態系的宏觀建構者」。您的療癒真言是：『我建立穩固的根基，並允許生命在其中自由流動與呼吸。』" },
                    { title: "事業與情感", content: "在事業上，您是頂尖的建築師、CEO、策略顧問、系統分析師、城市規劃者。您適合從事需要宏觀佈局與長遠規劃的工作。您是制定規則的人。但您需要學習「授權」，並信任團隊的創意。在情感關係中，您是極度可靠且有規劃的伴侶。您會將兩人的未來打理得井井有條。但您也需要學習「放下計畫」，享受當下的即興與浪漫。學會表達您的「感受」，而不只是您的「分析」，是您深化關係的關鍵。" }
                ]
            },
            "mentor": {
                title: "12 靈魂導師 (Soul Mentor)",
                tagline: "我是智慧的燈塔，我照亮他人的道路。",
                analysis: [
                    { title: "核心優勢：慈悲的智慧", content: "靈魂導師的核心本質，是「慈悲與智慧的融合」。您天生就帶著一股古老而安定的靈魂頻率，如同一個充滿智慧的長者。您聖潔、包容、且充滿同理心。人們會很自然地被您吸引，向您敞開心扉，因為他們在您身上感受到了「無條件的接納」。您的能量是溫暖的、光明的、充滿療癒力的，如同花香東方調，散發著神聖而溫暖的聖光。您不需主動，您的存在本身就是一種「引導」，能安撫焦慮的靈魂，並啟發他們找到自己的答案。" },
                    { title: "深度課題：界線與背負", content: "然而，靈魂導師最大的挑戰，在於「過度的承載」。您強大的同理心，使您如同海綿般吸納著周圍的負面情緒。您難以拒絕他人的求助，容易混淆「同理」與「同情」，進而「背負」起不屬於您的業力與責任。您以為這是在「拯救」他人，實則不然，這既消耗了您自己，也剝奪了對方學習成長的機會。您的課題在於學習「慈悲的界線」。您必須明白，真正的「導師」，是「賦權」他人，而非「代替」他人。" },
                    { title: "靈性揚升之路：從「拯救者」到「賦權者」", content: "您的靈性揚升之路，在於從一個「背負十字架的拯救者」，轉化為一個「點亮燈籠的賦權者」。您的工作不是「拉」著別人走，而是「照亮」他們腳下的路。\
                        香氛藝術能幫助您「清空」並「劃定界線」。在創作時，您可以引入「領導者」的赤紅色辛香調，觀想這股能量在您周圍建立一個「神聖的保護結界」。或者使用「成就者」的鎏金色，在畫布上宣告您「自我價值」的獨立，您不需要透過拯救他人來證明自己。\
                        這個練習是在提醒您「照顧好自己」是您的首要責任。當您學會了在保持慈悲的同時，也堅定地守護自己的能量邊界時，您才能真正地為他人服務而不受消耗。您從「疲憊的承擔者」，昇華為「賦權他人的智慧燈塔」。您的療癒真言是：『我以愛服務，但我只背負屬於我自己的。我照亮他人的道路，並信任他們有力量前行。』" },
                    { title: "事業與情感", content: "在事業上，您是天生的療癒師、諮商師、導師、神職人員、慈善家。您適合從事任何能發揮您「穩定」與「智慧」特質的服務業。您是絕佳的傾聽者。但您必須學會「收費」，肯定您服務的價值。在情感關係中，您是包容一切的「靈魂伴侶」。您能給予伴侶最深的理解與支持。但您要避免吸引需要「被拯救」的伴侶，而應尋找一個能與您「平等共修」的靈魂。學會在關係中也展現您「需要被照顧」的一面，是平衡的關鍵。" }
                ]
            }
        };


        // ======== 2. 抓取 DOM 元素 (不變) ========
        const elements = {
            userInfoModal: document.getElementById('user-info-modal'),
            userInfoForm: document.getElementById('user-info-form'),
            mainContent: document.getElementById('main-content'),
            userName: document.getElementById('user-name'),
            userPhone: document.getElementById('user-phone'),
            selects: { top: document.getElementById('select-top'), mid: document.getElementById('select-mid'), base: document.getElementById('select-base') },
            sliders: { top: document.getElementById('slider-top'), mid: document.getElementById('slider-mid'), base: document.getElementById('slider-base') },
            values: { top: document.getElementById('value-top'), mid: document.getElementById('value-mid'), base: document.getElementById('value-base') },
            params: { color: document.getElementById('slider-color'), spray: document.getElementById('slider-spray'), halo: document.getElementById('slider-halo') },
            generateBtn: document.getElementById('generate-btn'),
            artCanvas: document.getElementById('art-canvas'),
            startRecordBtn: document.getElementById('start-record-btn'),
            stopRecordBtn: document.getElementById('stop-record-btn'),
            screenshotBtn: document.getElementById('screenshot-btn'),
            infoText: document.getElementById('recorder-info'),
            audioPlayer: document.getElementById('bg-music'),
            inquiryForm: document.getElementById('inquiry-form'),
            inquiryName: document.getElementById('inquiry-name'),
            inquiryPhone: document.getElementById('inquiry-phone'),
            inquiryTitleContainer: document.getElementById('inquiry-title-container'),
            inquiryMessage: document.getElementById('inquiry-message'),

            // 報告按鈕
            reportBtn: document.getElementById('report-btn'),
            
            // 移除了報告模板相關元素
        };
        
        // Canvas (不變)
        const canvas = elements.artCanvas;
        const ctx = canvas.getContext('2d');
        canvas.width = 500;
        canvas.height = 500;

        // 系統變數 (不變)
        let particlesArray = [];
        let animationFrameId = null;
        let mediaRecorder;
        let recordedChunks = [];
        let videoSettings = {};
        let userInfo = {};

        // (下拉選單和拉桿的陣列，不變)
        const allSelects = [elements.selects.top, elements.selects.mid, elements.selects.base];
        const allSliders = [elements.sliders.top, elements.sliders.mid, elements.sliders.base];
        const allValues = [elements.values.top, elements.values.mid, elements.values.base];

        // ======== 3. 核心邏輯 (邏輯 A, B, C 不變) ========
        function populateSelects() {
            let optionsHtml = '';
            personalityData.forEach(p => {
                optionsHtml += `<option value="${p.id}">${p.name}</option>`;
            });
            allSelects.forEach((select, index) => {
                select.innerHTML = optionsHtml;
                select.selectedIndex = index; 
            });
        }
        function handleDropdownChange() {
            const selectedValues = allSelects.map(select => select.value);
            allSelects.forEach(select => {
                Array.from(select.options).forEach(option => {
                    const isSelectedElsewhere = selectedValues.includes(option.value);
                    const isSelf = option.value === select.value;
                    option.disabled = (isSelectedElsewhere && !isSelf);
                });
            });
        }
        function handleSliderChange(changedSlider) {
            let total = 0;
            allSliders.forEach(slider => total += parseInt(slider.value));
            let excess = total - 100;
            if (excess > 0) {
                const otherSliders = allSliders.filter(s => s !== changedSlider);
                otherSliders.sort((a, b) => parseInt(b.value) - parseInt(a.value));
                for (let slider of otherSliders) {
                    if (excess === 0) break;
                    let currentValue = parseInt(slider.value);
                    let reduction = Math.min(currentValue, excess);
                    slider.value = currentValue - reduction;
                    excess -= reduction;
                }
            }
            total = 0;
            allSliders.forEach(slider => total += parseInt(slider.value));
            let deficit = 100 - total;
            if (deficit > 0) {
                const otherSlider = allSliders.find(s => s !== changedSlider);
                otherSlider.value = parseInt(otherSlider.value) + deficit;
            }
            allSliders.forEach((slider, index) => {
                allValues[index].textContent = `${slider.value}%`;
            });
        }
        
        // ======== 4. 粒子系統邏輯 (不變) ========
        class Particle {
            constructor(x, y, color, baseOpacity) {
                this.x = x; this.y = y; this.color = color;
                this.size = Math.random() * 3 + 1;
                this.opacity = (Math.random() * 0.5 + 0.5) * (baseOpacity / 200);
                this.vx = (Math.random() - 0.5) * 2;
                this.vy = (Math.random() - 0.5) * 2;
                this.life = 1;
                this.decay = Math.random() * 0.01 + 0.005;
            }
            update() {
                this.x += this.vx; this.y += this.vy; this.life -= this.decay;
                if (this.life <= 0 || this.x < 0 || this.x > canvas.width || this.y < 0 || this.y > canvas.height) {
                    this.reset();
                }
            }
            draw() {
                ctx.beginPath();
                ctx.globalAlpha = Math.max(0, this.life * this.opacity);
                ctx.fillStyle = this.color;
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
            reset() {
                this.x = canvas.width / 2; this.y = canvas.height / 2;
                this.vx = (Math.random() - 0.5) * 2;
                this.vy = (Math.random() - 0.5) * 2;
                this.life = 1;
            }
        }
        function generateArt() {
            if (animationFrameId) { cancelAnimationFrame(animationFrameId); }
            particlesArray = [];
            const settings = {
                personalities: [
                    { id: elements.selects.top.value, percent: parseInt(elements.sliders.top.value) },
                    { id: elements.selects.mid.value, percent: parseInt(elements.sliders.mid.value) },
                    { id: elements.selects.base.value, percent: parseInt(elements.sliders.base.value) }
                ],
                baseOpacity: parseInt(elements.params.color.value),
                particleCount: parseInt(elements.params.spray.value) * 100,
                halo: parseInt(elements.params.halo.value) 
            };
            for (let i = 0; i < settings.particleCount; i++) {
                const rand = Math.random() * 100;
                let personality;
                if (rand < settings.personalities[0].percent) { personality = settings.personalities[0]; }
                else if (rand < settings.personalities[0].percent + settings.personalities[1].percent) { personality = settings.personalities[1]; }
                else { personality = settings.personalities[2]; }
                const color = personalityData.find(p => p.id === personality.id).color;
                particlesArray.push(new Particle(canvas.width / 2, canvas.height / 2, color, settings.baseOpacity));
            }
            animate(settings);
        }
        function animate(settings) {
            ctx.globalAlpha = 0.1; ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.shadowBlur = settings.halo / 2;
            for (let i = 0; i < particlesArray.length; i++) {
                ctx.shadowColor = particlesArray[i].color;
                particlesArray[i].update();
                particlesArray[i].draw();
            }
            ctx.shadowBlur = 0;
            animationFrameId = requestAnimationFrame(() => animate(settings));
        }

        // ======== 5. 錄影與截圖功能 (不變) ========
        function startRecording() {
            console.log("開始錄影...");
            recordedChunks = [];
            if (MediaRecorder.isTypeSupported('video/mp4; codecs=avc1')) {
                videoSettings.mimeType = 'video/mp4; codecs=avc1';
                videoSettings.fileExtension = 'mp4';
                elements.infoText.innerHTML = "ℹ️ 您的瀏覽器支援MP4。正在錄製為 <strong>.mp4</strong> 檔案。";
            } else {
                videoSettings.mimeType = 'video/webm; codecs=vp9';
                videoSettings.fileExtension = 'webm';
                elements.infoText.innerHTML = "ℹ️ 您的瀏覽器不支援MP4，已錄製為 <strong>.webm</strong>。<br>推薦使用 <a href='https://www.videolan.org/vlc/' target='_blank'>VLC Player</a> 播放。";
            }
            const stream = canvas.captureStream(30);
            try {
                mediaRecorder = new MediaRecorder(stream, { mimeType: videoSettings.mimeType });
            } catch (e) {
                console.error("MediaRecorder 初始化失敗:", e);
                elements.infoText.innerHTML = "❌ 錄影初始化失敗。瀏覽器不支援所選格式。";
                return;
            }
            mediaRecorder.ondataavailable = function(event) {
                if (event.data.size > 0) { recordedChunks.push(event.data); }
            };
            mediaRecorder.onstop = saveRecording;
            mediaRecorder.start();
            elements.startRecordBtn.disabled = true;
            elements.stopRecordBtn.disabled = false;
            elements.startRecordBtn.style.backgroundColor = '#444';
            elements.stopRecordBtn.style.backgroundColor = '#DC3545';
        }
        function stopRecording() {
            console.log("停止錄影...");
            if (mediaRecorder) { mediaRecorder.stop(); }
            elements.startRecordBtn.disabled = false;
            elements.stopRecordBtn.disabled = true;
            elements.startRecordBtn.style.backgroundColor = '#DC3545';
            elements.stopRecordBtn.style.backgroundColor = '#444';
            elements.infoText.innerHTML = "";
        }
        function saveRecording() {
            console.log("儲存錄影中...");
            if (recordedChunks.length === 0) { return; }
            const blob = new Blob(recordedChunks, { type: videoSettings.mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            document.body.appendChild(a);
            a.style = "display: none";
            a.href = url;
            a.download = `香氛人格_錄影.${videoSettings.fileExtension}`; 
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
        }
        function takeScreenshot() {
            console.log("截圖...");
            const dataURL = canvas.toDataURL("image/png");
            const a = document.createElement("a");
            document.body.appendChild(a);
            a.style = "display: none";
            a.href = dataURL;
            a.download = "香氛人格_截圖.png";
            a.click();
            document.body.removeChild(a);
        }

        // ======== 6. 訪客登錄、音樂、洽詢 功能 (使用 Netlify 提交) ========
        /*
         * 【音樂修正】
         * handleUserFormSubmit 已修改，將播放音樂移至最前方，
         * 以符合手機瀏覽器自動播放政策。
        */
        async function handleUserFormSubmit(event) {
            event.preventDefault(); // 阻止表單跳轉
            const formData = new FormData(elements.userInfoForm);

            // --- 【音樂修正】嘗試立即播放初始音樂 ---
            try {
                 // 假設 selects 已由 DOMContentLoaded 初始化
                 const initialTopNoteId = elements.selects.top.value;
                 const initialPersonality = personalityData.find(p => p.id === initialTopNoteId);
                 if (initialPersonality && initialPersonality.musicUrl) {
                     elements.audioPlayer.src = initialPersonality.musicUrl;
                     console.log("Attempting initial play:", elements.audioPlayer.src);
                     // 播放。若被阻擋，catch 會捕捉到
                     await elements.audioPlayer.play();
                     console.log("Initial playback started or resumed.");
                 } else {
                     console.warn("Could not find initial music URL for:", initialTopNoteId);
                 }
            } catch(e) {
                 console.warn("Initial music autoplay likely blocked by browser policy:", e);
                 // 這裡可以選擇性地顯示一個按鈕，讓用戶手動啟用聲音
            }
            // --- 結束音樂修正 ---

            // 立即禁用按鈕，防止重複提交
            const submitButton = elements.userInfoForm.querySelector('button[type="submit"]');
            if(submitButton) submitButton.disabled = true;

            try {
                // 2. 在背景提交表單到 Netlify
                await fetch("/", {
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    body: new URLSearchParams(formData).toString()
                });

                // 3. (提交成功後) 執行您原本的邏輯
                console.log("訪客登錄資料已提交至 Netlify");
                
                // 儲存訪客資料
                userInfo.name = elements.userName.value;
                userInfo.phone = elements.userPhone.value;
                userInfo.title = document.querySelector('input[name="user-title"]:checked').value;
                
                // 自動預填洽詢表單
                elements.inquiryName.value = userInfo.name;
                elements.inquiryPhone.value = userInfo.phone;
                elements.inquiryTitleContainer.innerHTML = `
                    <label><input type="radio" name="inquiry-title" value="先生" ${userInfo.title === '先生' ? 'checked' : ''} disabled> 先生</label>
                    <label><input type="radio" name="inquiry-title" value="小姐" ${userInfo.title === '小姐' ? 'checked' : ''} disabled> 小姐</label>
                `;
                
                // 隱藏 Modal，顯示主內容
                elements.userInfoModal.style.display = 'none';
                elements.mainContent.style.display = 'flex';
                
                // 初始化 APP 內容 (populateSelects 在 DOMContentLoaded 執行)
                handleDropdownChange(); // 確保下拉選單狀態正確
                generateArt(); // 產生第一次的藝術畫
                
                // 注意：這裡不再呼叫 updateMusic()，因為初始音樂已嘗試播放

            } catch (error) {
                console.error("Netlify 登錄表單提交失敗:", error);
                alert("抱歉，登錄時發生錯誤，請重新整理頁面。");
                 // 如果 fetch 失敗，重新啟用按鈕
                 if(submitButton) submitButton.disabled = false;
            }
        }
        function updateMusic() {
            const selectedId = elements.selects.top.value; // 以前調為主
            const personality = personalityData.find(p => p.id === selectedId);
            
            if (personality && personality.musicUrl) {
                console.log("播放音樂:", personality.musicUrl);
                elements.audioPlayer.src = personality.musicUrl;
                // 後續的播放（由用戶切換下拉選單觸發）通常不會被阻擋
                elements.audioPlayer.play().catch(e => console.warn("Music play failed:", e));
            }
        }
        async function handleInquirySubmit(event) {
            event.preventDefault(); // 阻止表單跳轉
            const formData = new FormData(elements.inquiryForm);
            formData.append('inquiry-title', userInfo.title); 

            try {
                await fetch("/", {
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    body: new URLSearchParams(formData).toString()
                });
                console.log("洽詢表單已提交至 Netlify");
                alert("感謝您的留言，我們已成功收到您的洽詢！");
                elements.inquiryMessage.value = ""; 

            } catch (error) {
                console.error("Netlify 洽詢表單提交失敗:", error);
                alert("抱歉，訊息發送失敗，請稍後再試。");
            }
        }

        /*
         * ======================================================================
         * 【AI 報告生成引擎】(改為開啟新分頁)
         * ======================================================================
        */
        
        // 新分頁報告的 CSS 樣式
        const reportPageStyles = `
            body {
                font-family: 'Times New Roman', 'KaiTi', '標楷體', serif;
                margin: 0;
                padding: 12mm; /* A4 邊界 (1.2cm) */
                background-color: #fff;
                color: #000;
            }
            .print-instructions {
                background-color: #fff9e6;
                border: 1px solid #ffcc80;
                padding: 15px;
                margin-bottom: 20px;
                border-radius: 5px;
                text-align: center;
                font-size: 11pt;
            }
            .print-instructions button {
                 padding: 8px 15px;
                 font-size: 10pt;
                 background-color: #ff6a00;
                 color: white;
                 border: none;
                 border-radius: 4px;
                 cursor: pointer;
            }
            h1 {
                font-size: 24pt;
                color: #222;
                border-bottom: 2px solid #ff6a00;
                padding-bottom: 10px;
                text-align: center;
                margin-top: 0;
            }
            h2 {
                font-size: 18pt;
                color: #ff6a00;
                border-bottom: 1px solid #ccc;
                padding-bottom: 5px;
                margin-top: 25px;
            }
            h3 {
                font-size: 14pt;
                color: #333;
                font-weight: bold;
                margin-top: 15px;
            }
            p {
                font-size: 12pt;
                line-height: 1.7;
                text-align: justify;
                margin-bottom: 15px; /* 增加段落間距 */
            }
            .user-info {
                font-size: 11pt;
                color: #555;
                background: #f4f4f4;
                padding: 15px;
                border-radius: 5px;
            }
            .formula-box {
                font-size: 12pt;
                color: #000;
                background: #fff9f2;
                border: 1px solid #ff6a00;
                padding: 20px;
                border-radius: 5px;
                margin-top: 20px;
                text-align: center;
            }
            .footer {
                margin-top: 40px;
                text-align: center;
                font-size: 10pt;
                color: #999;
            }
            /* 列印時隱藏提示 */
            @media print {
                .print-instructions {
                    display: none;
                }
            }
        `;

        // 函數：產生報告頁面
        function generateReportPage() {
            console.log("開始產生報告頁面...");

            // 1. 獲取三種人格的資料 (不變)
            const notes = [
                {
                    id: elements.selects.top.value,
                    name: elements.selects.top.options[elements.selects.top.selectedIndex].text,
                    percent: parseInt(elements.sliders.top.value),
                    originalNote: "前調"
                },
                {
                    id: elements.selects.mid.value,
                    name: elements.selects.mid.options[elements.selects.mid.selectedIndex].text,
                    percent: parseInt(elements.sliders.mid.value),
                    originalNote: "中調"
                },
                {
                    id: elements.selects.base.value,
                    name: elements.selects.base.options[elements.selects.base.selectedIndex].text,
                    percent: parseInt(elements.sliders.base.value),
                    originalNote: "後調"
                }
            ];

            // 2. 根據百分比排序，指派「人格角色」(不變)
            const sortedNotes = notes.sort((a, b) => b.percent - a.percent);
            const dominantNote = sortedNotes[0];
            const supportiveNote = sortedNotes[1];
            const foundationNote = sortedNotes[2];

            // 3. 獲取三種角色的「深度 AI 分析」(不變)
            const dominantInsight = personalityInsights[dominantNote.id];
            const supportiveInsight = personalityInsights[supportiveNote.id];
            const foundationInsight = personalityInsights[foundationNote.id];

            // 4. 動態組合報告的「核心內容 HTML」(不變)
            let reportContentHTML = "";
            const formulaText = `${dominantNote.percent}% ${dominantInsight.title} (${dominantNote.originalNote}) + \
                               ${supportiveNote.percent}% ${supportiveInsight.title} (${supportiveNote.originalNote}) + \
                               ${foundationNote.percent}% ${foundationInsight.title} (${foundationNote.originalNote})`;
            
            // --- 總結與配方 ---
            reportContentHTML += `
                <h2>您的靈魂藍圖：完美總和解說</h2>
                <p>親愛的 ${userInfo.name}，您此次的香氛人格配方，揭示了您當下獨一無二的心靈狀態。這不是一個靜態的標籤，而是一個動態的能量組合：</p>
                <p>您的「核心自我」由 <strong>${dominantNote.percent}% 的 ${dominantInsight.title}</strong> 作為**主導特質**。這決定了您向外展現的主要樣貌、您的核心優勢與此生最關鍵的課題。</p>
                <p>這股主導能量，透過 <strong>${supportiveNote.percent}% 的 ${supportiveInsight.title}</strong> 作為**輔助特質**來表達。這是您用以應對世界、執行您主導特質的方法與工具。</p>
                <p>而這一切，都深深紮根在 <strong>${foundationNote.percent}% 的 ${foundationInsight.title}</strong> 作為**根基特質**。這是您的潛意識、您隱藏的力量，也是您在感到迷惘時，最需要回頭滋養的內在土壤。</p>
                
                <h2>您的專屬揚升配方</h2>
                <div class="formula-box">
                    <p>您的靈魂在此刻，已經透過您的直覺，為您調配出最適合您當下狀態的靈性揚升配方。這個配方就是您所選的：</p>
                    <p><strong>${formulaText}</strong></p>
                    <p>這份報告將協助您深入理解這個配方中蘊含的智慧。請您在生活中，時常冥想這三種人格的香氣與色彩，它們將是您全面昇華、平衡身心的最佳引導。</p>
                </div>
            `;
            // --- 主導特質分析 ---
            reportContentHTML += `
                <h2>您的主導特質 (${dominantNote.percent}%): ${dominantInsight.title}</h2>
                <p><i>「${dominantInsight.tagline}」</i></p>`;
            dominantInsight.analysis.forEach(section => {
                reportContentHTML += `<h3>${section.title}</h3><p>${section.content}</p>`;
            });
            // --- 輔助特質分析 ---
            reportContentHTML += `
                <h2>您的輔助特質 (${supportiveNote.percent}%): ${supportiveInsight.title}</h2>
                <p><i>「${supportiveInsight.tagline}」</i></p>
                <p>這股力量是您達成「${dominantInsight.title}」使命所使用的「方法」。它以 ${supportiveNote.percent}% 的比例，溫和地輔助您的核心自我。</p>`;
            supportiveInsight.analysis.forEach(section => {
                reportContentHTML += `<h3>${section.title}</h3><p>${section.content}</p>`;
            });
            // --- 根基特質分析 ---
            reportContentHTML += `
                <h2>您的根基特質 (${foundationNote.percent}%): ${foundationInsight.title}</h2>
                <p><i>「${foundationInsight.tagline}」</i></p>
                <p>這股力量是您人格的「潛意識根基」。它以 ${foundationNote.percent}% 的比例，在底層默默地支持或牽引著您。滋養這股根基能量，能為您帶來意想不到的內在平靜與力量。</p>`;
            foundationInsight.analysis.forEach(section => {
                reportContentHTML += `<h3>${section.title}</h3><p>${section.content}</p>`;
            });

            // 5. 建立新分頁的完整 HTML (不變)
            const reportFullHTML = `
                <!DOCTYPE html>
                <html lang="zh-Hant">
                <head>
                    <meta charset="UTF-8">
                    <title>${userInfo.name} 的香氛人格報告</title>
                    <style>${reportPageStyles}</style>
                </head>
                <body>
                    <div class="print-instructions">
                        💡 如何儲存報告：請使用瀏覽器的「列印」功能 (Ctrl+P 或 Cmd+P)，並在目的地選擇「另存為 PDF」。
                        <button onclick="window.print()">立即列印 / 儲存 PDF</button>
                    </div>

                    <h1>您的專屬香氛人格分析報告</h1>
                    
                    <div class="user-info">
                        <p><strong>致：</strong> ${userInfo.name} ${userInfo.title}</p>
                        <p><strong>人格配方：</strong> ${formulaText}</p>
                        <p><strong>報告日期：</strong> ${new Date().toLocaleDateString('zh-TW')}</p>
                    </div>

                    ${reportContentHTML} 

                    <div class="footer">
                        <p>此報告由 神話香氛藝術學院 3D香氛藝術平台生成</p>
                        <p>&copy; 2025 版權所有</p>
                    </div>
                </body>
                </html>
            `;

            // 6. 開啟新分頁並寫入 HTML (不變)
            const reportWindow = window.open('', '_blank');
            if (reportWindow) {
                reportWindow.document.open();
                reportWindow.document.write(reportFullHTML);
                reportWindow.document.close();
                console.log("報告已在新分頁開啟！");
            } else {
                alert("無法開啟新分頁，請檢查您的瀏覽器是否阻擋了彈出視窗。");
            }
        }

        // ======== 7. 綁定事件監聽器 (不變) ========
        document.addEventListener('DOMContentLoaded', () => {
            // 【音樂修正】確保 DOMContentLoaded 時 selects 已填充
            populateSelects(); 
            
            elements.userInfoForm.addEventListener('submit', handleUserFormSubmit);
            elements.stopRecordBtn.disabled = true; 
            elements.infoText.innerHTML = "";
            
            allSelects.forEach(select => {
                select.addEventListener('change', handleDropdownChange);
            });
            allSliders.forEach(slider => {
                slider.addEventListener('input', () => handleSliderChange(slider));
            });
            elements.generateBtn.addEventListener('click', generateArt);
            
            elements.startRecordBtn.addEventListener('click', startRecording);
            elements.stopRecordBtn.addEventListener('click', stopRecording);
            elements.screenshotBtn.addEventListener('click', takeScreenshot);
            
            // 綁定音樂更新（當前調改變時）
            elements.selects.top.addEventListener('change', updateMusic);
            
            elements.inquiryForm.addEventListener('submit', handleInquirySubmit);

            // 綁定報告函數
            elements.reportBtn.addEventListener('click', generateReportPage);
        });
    </script>
</body>
</html>


