<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>香氛人格 藝術創作平台</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    
    <style>
        /* --- 基礎樣式 --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #121212;
            color: #E0E0E0;
            margin: 0;
            padding: 0;
        }
        h2, h3 {
            border-bottom: 2px solid #444;
            padding-bottom: 8px;
            margin-top: 10px;
        }
        
        /* --- 主內容包裝 (預設隱藏) --- */
        #main-content {
            display: none; 
            justify-content: center;
            align-items: flex-start;
            padding: 20px;
            gap: 30px;
            flex-wrap: wrap;
        }
        
        /* --- 訪客登錄彈窗 --- */
        #user-info-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        #user-info-form {
            background-color: #1E1E1E;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.5);
            width: 400px;
            max-width: 90%;
        }
        #user-info-form h2 {
            text-align: center;
            margin-top: 0;
        }
        .form-field {
            margin-bottom: 20px;
        }
        .form-field label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #AAA;
        }
        .form-field input[type="text"],
        .form-field input[type="tel"] {
            width: 100%;
            padding: 12px;
            border-radius: 6px;
            border: 1px solid #555;
            background-color: #333;
            color: #E0E0E0;
            box-sizing: border-box;
            font-size: 1rem;
        }
        .form-field-radio {
            display: flex;
            gap: 20px;
        }
        .form-field-radio label {
            color: #E0E0E0;
            font-weight: normal;
        }
        #user-info-form button {
            background-color: #0D6EFD;
        }
        #user-info-form button:hover {
            background-color: #0A58CA;
        }


        /* --- 控制面板 --- */
        #controls {
            width: 400px;
            min-width: 320px;
            background-color: #1E1E1E;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.5);
        }
        .control-group { margin-bottom: 20px; }
        .control-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 0.9rem;
            color: #AAA;
        }
        select, input[type="range"] {
            width: 100%;
            padding: 8px;
            border-radius: 6px;
            border: 1px solid #555;
            background-color: #333;
            color: #E0E0E0;
            box-sizing: border-box;
        }
        input[type="range"] { padding: 0; }
        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .slider-value {
            font-weight: bold;
            font-size: 1rem;
            color: #FFF;
            min-width: 45px;
            text-align: right;
        }
        
        /* --- 按鈕樣式 --- */
        button {
            width: 100%;
            padding: 12px;
            font-size: 1.1rem;
            font-weight: bold;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: 10px;
        }
        button:disabled {
            background-color: #555;
            cursor: not-allowed;
            opacity: 0.7;
        }
        #generate-btn { background-color: #0D6EFD; }
        #generate-btn:hover:not(:disabled) { background-color: #0A58CA; }
        #tools-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        #screenshot-btn {
            grid-column: 1 / -1;
            background-color: #198754;
        }
        #screenshot-btn:hover:not(:disabled) { background-color: #157347; }
        #start-record-btn { background-color: #DC3545; }
        #start-record-btn:hover:not(:disabled) { background-color: #BB2D3B; }
        #stop-record-btn { background-color: #444; }
        #stop-record-btn:hover:not(:disabled) { background-color: #333; }
        .info-text {
            font-size: 0.9rem;
            color: #aaa;
            background-color: #2a2a2a;
            padding: 10px;
            border-radius: 6px;
            margin-top: 15px;
            line-height: 1.5;
        }
        .info-text a {
            color: #58a6ff;
            text-decoration: none;
        }
        .info-text a:hover {
            text-decoration: underline;
        }

        /* --- 藝術畫布 --- */
        #output-container {
            width: 500px;
            max-width: 90vw;
            background-color: #000;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0,0,0,0.5);
        }
        #art-canvas {
            aspect-ratio: 1 / 1;
            width: 100%;
            background-color: #000;
            display: block;
        }
        
        /* --- 洽詢表單樣式 --- */
        #inquiry-form textarea {
            width: 100%;
            height: 120px;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #555;
            background-color: #333;
            color: #E0E0E0;
            box-sizing: border-box;
            font-size: 1rem;
            font-family: inherit;
        }
        #inquiry-form button {
            background-color: #ff6a00;
        }
        #inquiry-form button:hover {
            background-color: #e05c00;
        }
        #inquiry-form input[type="text"],
        #inquiry-form input[type="tel"] {
             width: 100%;
            padding: 12px;
            border-radius: 6px;
            border: 1px solid #555;
            background-color: #333;
            color: #E0E0E0;
            box-sizing: border-box;
            font-size: 1rem;
        }
        
        /* --- PDF 報告按鈕 --- */
        #report-btn {
            background-color: #ff6a00; /* 醒目的橘色 */
            grid-column: 1 / -1; /* 佔滿整行 */
        }
        #report-btn:hover:not(:disabled) {
            background-color: #e05c00;
        }
        
        /* --- PDF 報告模板 (隱藏) --- */
        #report-template {
            display: none; /* 預設隱藏 */
            width: 210mm; /* A4 寬度 */
            padding: 20mm; /* A4 邊界 */
            box-sizing: border-box;
            color: #000; /* PDF 內文用黑色 */
            background: #fff;
            font-family: 'Times New Roman', 'KaiTi', '標楷體', serif; /* 使用支援中文的字體 */
        }
        #report-template h1 {
            font-size: 24pt;
            color: #333;
            border-bottom: 2px solid #ff6a00;
            padding-bottom: 10px;
            text-align: center;
        }
        #report-template h2 {
            font-size: 18pt;
            color: #ff6a00;
            border-bottom: 1px solid #ccc;
            padding-bottom: 5px;
            margin-top: 25px;
        }
        #report-template h3 {
            font-size: 14pt;
            color: #333;
            font-weight: bold;
            margin-top: 15px;
        }
        #report-template p, #report-template li {
            font-size: 12pt;
            line-height: 1.6;
            text-align: justify;
            margin-bottom: 10px;
        }
        #report-template ul {
            padding-left: 20px;
        }
        #report-template .user-info {
            font-size: 11pt;
            color: #555;
            background: #f4f4f4;
            padding: 15px;
            border-radius: 5px;
        }
        #report-template .recipe-box {
            font-size: 12pt;
            color: #333;
            background: #fff9f0;
            border: 1px solid #ffcda1;
            padding: 20px;
            border-radius: 8px;
            margin-top: 15px;
        }
        #report-template .recipe-box h3 {
            margin-top: 0;
            color: #d95b00;
        }
        #report-template .footer {
            margin-top: 40px;
            text-align: center;
            font-size: 10pt;
            color: #999;
        }
        
    </style>
</head>
<body>

    <div id="user-info-modal">
        <form id="user-info-form" name="visitor-login" data-netlify="true">
            <input type="hidden" name="form-name" value="visitor-login" />
            
            <h2>香氛人格 藝術創作</h2>
            <div class="form-field">
                <label for="user-name">您的姓名</label>
                <input type="text" id="user-name" name="user-name" required>
            </div>
            <div class="form-field">
                <label for="user-phone">您的電話</label>
                <input type="tel" id="user-phone" name="user-phone" required>
            </div>
            <div class="form-field">
                <label>您的稱謂</label>
                <div class="form-field-radio">
                    <label><input type="radio" name="user-title" value="先生" checked> 先生</label>
                    <label><input type="radio" name="user-title" value="小姐"> 小姐</label>
                </div>
            </div>
            <button type="submit">開始創作</button>
        </form>
    </div>

    <div id="main-content">
        <div id="controls">
            <h2>香氛人格設定</h2>
            <div class="control-group">
                <h3>前調 (Top Note)</h3>
                <select id="select-top" class="personality-select"></select>
                <div class="slider-container">
                    <input type="range" id="slider-top" class="percentage-slider" min="0" max="100" value="34">
                    <span id="value-top" class="slider-value">34%</span>
                </div>
            </div>
            <div class="control-group">
                <h3>中調 (Middle Note)</h3>
                <select id="select-mid" class="personality-select"></select>
                <div class="slider-container">
                    <input type="range" id="slider-mid" class="percentage-slider" min="0" max="100" value="33">
                    <span id="value-mid" class="slider-value">33%</span>
                </div>
            </div>
            <div class="control-group">
                <h3>後調 (Base Note)</h3>
                <select id="select-base" class="personality-select"></select>
                <div class="slider-container">
                    <input type="range" id="slider-base" class="percentage-slider" min="0" max="100" value="33">
                    <span id="value-base" class="slider-value">33%</span>
                </div>
            </div>
            
            <h2>全域參數</h2>
            <div class="control-group">
                <label for="slider-color">顏色強度 (Color Intensity)</label>
                <input type="range" id="slider-color" min="50" max="200" value="100">
            </div>
            <div class="control-group">
                <label for="slider-spray">噴霧濃度 (Spray Concentration)</label>
                <input type="range" id="slider-spray" min="10" max="50" value="25">
            </div>
            <div class="control-group">
                <label for="slider-halo">光暈強度 (Halo Intensity)</label>
                <input type="range" id="slider-halo" min="0" max="100" value="30">
            </div>
            
            <button id="generate-btn">生成香氛藝術創作</button>
            
            <h2 style="margin-top: 30px;">創作工具</h2>
            <div id="tools-container">
                <button id="start-record-btn">開始錄影</button>
                <button id="stop-record-btn">停止並儲存</button>
                <button id="screenshot-btn">截圖並儲存</button>

                <button id="report-btn">產生您的香氛人格報告</button>
            </div>
            <p id="recorder-info" class="info-text"></p>
            
            <h2 style="margin-top: 30px;">探索服務留言</h2>
            <form id="inquiry-form" name="service-inquiry" data-netlify="true">
                <input type="hidden" name="form-name" value="service-inquiry" />
                
                <div class="form-field">
                    <label for="inquiry-name">您的姓名 (自動帶入)</label>
                    <input type="text" id="inquiry-name" name="inquiry-name" readonly>
                </div>
                <div class="form-field">
                    <label for="inquiry-phone">您的電話 (自動帶入)</label>
                    <input type="tel" id="inquiry-phone" name="inquiry-phone" readonly>
                </div>
                 <div class="form-field">
                    <label>您的稱謂 (自動帶入)</label>
                    <div class="form-field-radio" id="inquiry-title-container"></div>
                </div>
                <div class="form-field">
                    <label for="inquiry-message">您的留言</label>
                    <textarea id="inquiry-message" name="inquiry-message" placeholder="我想進一步了解..." required></textarea>
                </div>
                <button type="submit">送出洽詢</button>
            </form>
            
        </div>

        <div id="output-container">
            <canvas id="art-canvas"></canvas>
        </div>
    </div>
    
    <audio id="bg-music" loop></audio>

    <div id="report-template">
        <h1>您的專屬香氛人格分析報告</h1>
        <div class="user-info">
            <p><strong>致：</strong> <span id="report-user-name"></span></p>
            <p><strong>人格配方：</strong> <span id="report-formula"></span></p>
            <p><strong>報告日期：</strong> <span id="report-date"></span></p>
        </div>
        
        <div id="report-synergy"></div>

        <div id="report-content"></div>

        <div id="report-recipe"></div>

        <div class="footer">
            <p>此報告由 3D 香氛藝術 (3dfragranceart) 平台生成</p>
            <p>&copy; 2025 版權所有</p>
        </div>
    </div>


    <script>
        // ======== 1. 資料庫 (音樂檔名 `01.mp3` ... ) ========
        const personalityData = [
            { id: "leader", name: "01 領導者 (Leader)", color: "#FF0000", musicUrl: "music/01.mp3" },
            { id: "collaborator", name: "02 合作者 (Collaborator)", color: "#FF6200", musicUrl: "music/02.mp3" },
            { id: "creator", name: "03 創意者 (Creator)", color: "#FFB005", musicUrl: "music/03.mp3" },
            { id: "implementer", name: "04 實踐者 (Implementer)", color: "#489103", musicUrl: "music/04.mp3" },
            { id: "adventurer", name: "05 冒險者 (Adventurer)", color: "#0559AD", musicUrl: "music/05.mp3" },
            { id: "guardian", name: "06 守護者 (Guardian)", color: "#1E0369", musicUrl: "music/06.mp3" },
            { id: "explorer", name: "07 探索者 (Explorer)", color: "#650280", musicUrl: "music/07.mp3" },
            { id: "achiever", name: "08 成就者 (Achiever)", color: "#DE8909", musicUrl: "music/08.mp3" },
            { id: "idealist", name: "09 理想者 (Idealist)", color: "#FAE171", musicUrl: "music/09.mp3" },
            { id: "inspirator", name: "10 靈感者 (Inspirator)", color: "#E3E4E6", musicUrl: "music/10.mp3" },
            { id: "architect", name: "11 建築大師 (Architect)", color: "#692C00", musicUrl: "music/11.mp3" },
            { id: "mentor", name: "12 靈魂導師 (Soul Mentor)", color: "#FFFACD", musicUrl: "music/12.mp3" }
        ];

        /*
         * 【重大升級 1/3】
         * 預先建置的 800+ 字深度 AI 分析資料庫 (由 Gemini 撰寫)
        */
        const personalityInsights = {
            "leader": {
                title: "01 領導者 (Leader)",
                strength: `<h3>主要優勢：天生的領航者</h3>
<p>您的人格核心關鍵字是「意志」與「方向」。您是天生的先行者，內在擁有一股強大的驅動力，促使您在任何情境中都傾向於掌握主導權。您的思維清晰、目標導向，並且擁有將複雜問題簡化的天賦。您不畏懼衝突，甚至視其為達成目標的必要過程。這種果斷與權威的特質，使您在團體中自然而然地散發出領袖魅力，人們會不自覺地尋求您的指引。</p>
<p>在工作中，您是高效的推動者，能夠迅速制定戰略並分配任務。您重視結果，並且有能力帶領團隊穿越迷霧，達成目標。在人際關係中，您扮演著「保護者」與「提供者」的角色，會為您所愛的人扛起重責，提供堅實的依靠。您的木質辛香調能量，如同炙熱的營火，為周圍的人帶來方向感與安全感。</p>`,
                challenge: `<h3>潛在陰影：過度的掌控</h3>
<p>「領導者」最大的靈性課題，在於處理「掌控」與「脆弱」。您對「失控」有著深深的恐懼，這股恐懼會將您強大的領導力轉化為僵化的「控制欲」。當事情未如預期發展時，您可能會變得不耐煩、獨斷專行，甚至壓制他人的意見。您習慣於發號施令，卻拙於傾聽；您擅長展現力量，卻羞於顯露脆弱。</p>
<p>這種特質可能導致您在人際關係中築起高牆，讓人覺得難以親近。您的夥伴和團隊成員可能因為害怕您的權威而不敢提出真實的想法，導致您陷入「高處不勝寒」的孤立。您將自我價值與「成功」和「掌控」緊密綑綁，這使您難以真正放鬆，時常處於戰備狀態，長期下來會消耗巨大的心神。</p>`,
                suggestion: `<h3>靈性揚升與香氛建議</h3>
<p>您的靈魂功課，是從「統治 (Rule)」昇華為「啟發 (Inspire)」。您需要學習，真正的力量並非來自「壓倒一切」，而是來自「賦權他人」。您的揚升之路始於「傾聽」與「示弱」。</p>
<ul>
    <li><b>學習傾聽：</b> 在會議中，練習讓自己成為最後一個發言的人。主動詢問他人的看法，並真心去理解，而非僅是為了反駁。</li>
    <li><b>擁抱脆弱：</b> 學習在安全的關係中，表達您的不確定性與需求。您會發現，顯露脆弱不但不會減損您的權威，反而會贏得他人更深的信任。</li>
    <li><b>香氛藝術療法：</b> 您的木質辛香調（如雪松、黑胡椒）是您的力量來源，但在您感到緊繃時，請在您的香氛藝術創作中，有意識地引入「互補」的能量。嘗試使用<b>「02 合作者」</b>的溫暖白花香調（如茉莉、依蘭）來軟化您過於銳利的線條；或使用<b>「09 理想者」</b>的柔和月光色（如羅馬洋甘菊、薰衣草），在您的赤紅色畫布上點綴出寧靜的空間。這能幫助您在堅定中找回柔韌，發展出更具包容性的「王者風範」。</li>
</ul>`
            },
            "collaborator": {
                title: "02 合作者 (Collaborator)",
                strength: `<h3>主要優勢：和諧的編織者</h3>
<p>您的人格核心關鍵字是「連結」與「同理」。您是群體中的黏著劑，擁有敏銳的感知力，能輕易察覺他人的情緒與需求。您天生厭惡衝突，並致力於創造和諧、包容的氛圍。您是絕佳的傾聽者、調解者與支持者。您的溫和與溫暖，如同白花麝香調的香氣，讓人感到舒適、安全，並願意向您敞開心扉。</p>
<p>在工作中，您是團隊合作的最佳催化劑。您不爭功諉過，總是默默地補足團隊的缺口，確保流程順暢。在人際關係中，您是那個永遠「在場」的朋友，給予無條件的支持與理解。您深信「關係」重於一切，並願意為此付出努力。您的存在本身就是一種療癒，能平復周遭的焦慮與對立。</p>`,
                challenge: `<h3>潛在陰影：失去自我</h3>
<p>「合作者」最大的靈性課題，在於「邊界」與「自我」。您對和諧的極度渴望，有時會讓您付出「失去自我」的代價。您害怕衝突，因此可能會壓抑自己真實的需求與感受，只為迎合他人、避免對立。您習慣於「配合」，卻忘記了「表達」。</p>
<p>這可能導致您在關係中過度犧牲，承載了不屬於您的情緒重擔。久而久之，您會感到被掏空、被利用，甚至心生怨懟，但又因為害怕破壞關係而不敢言說。您容易在群體中失去自己的聲音，您的價值似乎必須透過「被他人需要」來體現，這使您難以獨立做出重大決定。</p>`,
                suggestion: `<h3>靈性揚升與香氛建議</h3>
<p>您的靈魂功課，是從「迎合 (Please)」昇華為「共創 (Co-create)」。您需要學習，真正的和諧並非來自「壓抑自我」，而是來自「真實的交流」。您的揚升之路始於「設立邊界」與「肯定自我」。</p>
<ul>
    <li><b>練習說「不」：</b> 從小事開始，溫和而堅定地拒絕那些您不想做的事。您會發現，健康的關係不會因此而破碎。</li>
    <li><b>找回聲音：</b> 每天給自己一段獨處時間，問自己：「我真正想要的是什麼？」並嘗試在關係中表達這個需求。</li>
    <li><b>香氛藝術療法：</b> 您的白花麝香調（如橙花、晚香玉）是您的天賦。當您感到自我模糊時，請在您的香氛藝術中，刻意加入「對立」的能量。嘗試使用<b>「01 領導者」</b>的赤紅色木質辛香調（如薑、檀香），在您的畫布上畫下清晰、有力的線條，這是在宣告您的「邊界」。或者，使用<b>「08 成就者」</b>的鎏金色，提醒自己「我的需求同樣重要」。這能幫助您在溫暖包容的同時，站穩自己的腳跟，從「附和者」昇華為「積極的共創者」。</li>
</ul>`
            },
            "creator": {
                title: "03 創意者 (Creator)",
                strength: `<h3>主要優勢：靈感的泉源</h3>
<p>您的人格核心關鍵字是「可能性」與「表達」。您是靈感的化身，擁有一顆永不枯竭的好奇心和跳躍性的思維。您的世界是五彩斑斕的，您能從最平凡的日常中萃取出不凡的創意。您靈巧、自由、不喜受限，總是能帶來新奇的觀點與令人驚喜的解決方案。您的柑橘花香調能量，如同陽光下閃爍的露珠，清新、明亮且充滿喜悅的生命力。</p>
<p>在工作中，您是「點子王」，是推動創新與變革的靈魂人物。您享受「從 0 到 1」的過程。在生活中，您是個有趣的人，充滿藝術氣息與幽默感，能為周遭帶來歡笑與活力。您是天生的藝術家，無論是透過繪畫、音樂、文字還是烹飪，您都需要一個管道來抒發您內在源源不絕的創造力。</p>`,
                challenge: `<h3>潛在陰影：難以落地</h3>
<p>「創意者」最大的靈性課題，在於「紀律」與「完成」。您熱愛「開始」的興奮感，卻容易在「執行」的枯燥中失去耐性。您可能有無數個「半成品」，點子很多，但真正「完成」的卻很少。您對自由的極度渴望，有時會讓您顯得不切實際，逃避紀律、承諾與責任。</p>
<p>這可能導致您在職涯中難以積累具體的成就，儘管您才華洋溢。您豐沛的能量如果沒有出口，會轉而在內在世界中形成「創意焦慮」—— 總覺得自己應該在做什麼，卻又不知從何開始。您害怕「無聊」，因此可能不斷追逐新的刺激，難以在單一領域深耕。</p>`,
                suggestion: `<h3>靈性揚升與香氛建議</h3>
<p>您的靈魂功課，是從「夢想 (Dream)」昇華為「創造 (Create)」。您需要學習，真正的自由並非「毫無限制」，而是在「結構中依然能自在舞蹈」。您的揚升之路始于「聚焦」與「執行」。</p>
<ul>
    <li><b>建立結構：</b> 為您的創意設立一個「容器」。這可以是一個固定的工作時間、一個明確的專案死線，或一個簡單的創作儀式。</li>
    <li><b>擁抱枯燥：</b> 接受任何偉大的創作都包含 80% 的枯燥執行。將執行本身也視為一種「工藝」的展現。</li>
    <li><b>香氛藝術療法：</b> 您的柑橘花香調（如佛手柑、葡萄柚）是您啟動靈感的鑰匙。當您需要「落地」時，請在您的香氛藝術中，引入「穩定」的能量。強烈建議您使用<b>「11 建築大師」</b>的大地色綠意柑苔調（如岩蘭草、廣藿香），或<b>「04 實踐者」</b>的翠岩色木質調。這能為您飛揚的靈感提供一個穩固的「錨點」，幫助您將天馬行空的想法，紮實地建構在現實之中，從「夢想家」昇華為「創造實相的大師」。</li>
</ul>`
            },
            "implementer": {
                title: "04 實踐者 (Implementer)",
                strength: `<h3>主要優勢：穩健的基石</h3>
<p>您的人格核心關鍵字是「耐力」與「責任」。您是將願景化為現實的關鍵力量，是社會中不可或缺的穩定基石。您務實、穩健、極具耐心與責任感。您不尚空談，只相信「一步一腳印」的力量。您是那種會默默耕耘，並確保所有細節都準確無誤的人。您的木質芳香-柑苔調能量，如同深植大地、枝繁葉茂的橡樹，給人無比的可靠與堅毅感。</p>
<p>在工作中，您是組織的「定海神針」。您可以被託付最艱鉅、最繁瑣的任務，並且總能有條不紊地將其完成。您重視流程、紀律與品質。在人際關係中，您是那個「言出必行」的朋友，您的承諾重若千金。您透過「具體的行動」來表達關心，例如幫忙修理東西、準時赴約，或提供實際的幫助。</p>`,
                challenge: `<h3>潛在陰影：抗拒變化</h3>
<p>「實踐者」最大的靈性課題，在於「彈性」與「信念」。您對「既定流程」和「過往經驗」的依賴，有時會讓您變得僵化與固執。您害怕「不確定性」，因此會本能地抗拒改變、排斥新的方法。您重視「做對」，有時卻忽略了可能有「更好」或「更快」的方式。</p>
<p>這可能導致您錯失創新的機會，或在面對突發狀況時反應遲緩。您傾向於「安全」而非「卓越」。在心靈層面，您可能過度依賴物質世界的邏輯，而忽略了直覺與信念的力量，有時會陷入「非如此不可」的思維定勢中，缺乏想像力。</p>`,
                suggestion: `<h3>靈性揚升與香氛建議</h3>
<p>您的靈魂功課，是從「執行 (Execute)」昇華為「精進 (Refine)」。您需要學習，真正的穩定並非「一成不變」，而是「在變動中保持核心」。您的揚升之路始于「開放」與「信任直覺」。</p>
<ul>
    <li><b>嘗試新路：</b> 刻意在日常生活中做一件「偏離常軌」的小事，例如走不同的路上班、嘗試新的食譜。</li>
    <li><b>接納混亂：</b> 當變化發生時，練習深呼吸，告訴自己：「這是一個學習的機會，而非威脅。」</li>
    <li><b>香氛藝術療法：</b> 您的柑苔調（如快樂鼠尾草、絲柏）是您穩定的力量。當您感覺陷入僵局時，請在您的香氛藝術中，注入「流動」的能量。強烈建議您使用<b>「03 創意者」</b>的靈動柑橘花香調（如檸檬、甜橙），或<b>「05 冒險者」</b>的清新木質調（如薄荷、迷迭香）。這能幫助您在穩定的結構中，注入活潑的氣息，打破僵化的思維，讓您在變動的時代中，從「可靠的執行者」昇華為「應變自如的工匠大師」。</li>
</ul>`
            },
            "adventurer": {
                title: "05 冒險者 (Adventurer)",
                strength: `<h3>主要優勢：自由的探險家</h3>
<p>您的人格核心關鍵字是「自由」與「體驗」。您是充滿好奇心與勇氣的靈魂，來到這個世界上就是為了「體驗」生命所能提供的廣度。您不懼怕風險，甚至渴望刺激與未知。您是樂觀的、適應力強的，並且擁有「活在當下」的非凡能力。您的清新木質調能量，如同穿梭山林的疾風，又如奔騰入海的溪流，充滿活力、不受拘束，總是向著下一個地平線奔去。</p>
<p>在工作中，您是絕佳的「開創者」與「問題解決者」。您能在混亂的環境中保持冷靜，並享受挑戰帶來的快感。您適合變動性高、充滿新奇的任務。在人際關係中，您是那個總能帶來新鮮話題與有趣活動的夥伴，您的熱情極具感染力。</p>`,
                challenge: `<h3>潛在陰影：逃避承諾</h3>
<p>「冒險者」最大的靈性課題，在於「深度」與「承諾」。您對「下一個」新事物的無盡追求，有時會讓您對「當下」的人事物失去耐性。您害怕「無聊」，更害怕「被束縛」，這可能導致您在工作或關係中難以深耕。您可能在事情變得「困難」或「平凡」時就選擇離開，逃避隨之而來的責任與深層的情感連結。</p>
<p>這可能使您的人生雖然「廣闊」，卻缺乏「厚度」。您體驗了很多，但可能很少有真正「精通」的。您害怕承諾，因為承諾意味著「限制」，而這正是您最想逃離的。您需要學習，真正的自由不是「為所欲為」，而是「有所不為」的選擇。</p>`,
                suggestion: `<h3>靈性揚升與香氛建議</h3>
<p>您的靈魂功課，是從「體驗 (Experience)」昇華為「精通 (Master)」。您需要學習，真正的滿足感往往來自「深度」，而非「廣度」。您的揚升之路始于「專注」與「扎根」。</p>
<ul>
    <li><b>完成一件事：</b> 選擇一個您總是「半途而廢」的領域（無論是學樂器、一個專案或一段關係），並承諾自己「完成它」。</li>
    <li><b>擁抱平凡：</b> 練習在平凡的日常中尋找樂趣，而非總在外在世界尋求刺激。</li>
    <li><b>香氛藝術療法：</b> 您的清新木質調（如杜松、尤加利）是您的動力。當您需要「安定」下來時，請在您的香氛藝術中，加入「扎根」的能量。強烈建議您使用<b>「06 守護者」</b>的靛藍色草本調（如馬鬱蘭、羅勒），這能提供您情感上的「安全感」；或使用<b>「11 建築大師」</b>的穩固大地色（如岩蘭草、廣藿香），為您的疾風建立一個「家」。這能幫助您將豐富的體驗轉化為深刻的智慧，從「漂泊者」昇華為「有智慧的探險家」。</li>
</ul>`
            },
            "guardian": {
                title: "06 守護者 (Guardian)",
                strength: `<h3>主要優勢：忠誠的捍衛者</h3>
<p>您的人格核心關鍵字是「忠誠」與「安定」。您是天生的「穩定力量」，是家庭、組織和傳統的忠實捍衛者。您極度重視安全感、責任與承諾。您是那種一旦做出承諾，就會全力以赴、絕不背棄的人。您的草本花香木質調能量，如同一個堅固而溫暖的屏障，給予您所守護的人事物無比的安心與可靠感。</p>
<p>在工作中，您是組織中最值得信賴的成員。您勤勉、細心，並且會堅定地執行規則與程序，確保一切穩定運行。您不喜歡風險，傾向於遵循已被驗證的道路。在人際關係中，您是「慢熱」但「長久」的類型。一旦您認定一個人，您會給予全然的忠誠與保護，是極為可靠的伴侶與朋友。</p>`,
                challenge: `<h3>潛在陰影：恐懼未知</h3>
<p>「守護者」最大的靈性課題，在於「信任」與「放下」。您對「安全」的極度需求，源於內在對「失控」與「未知」的深深恐懼。這會使您變得多疑、焦慮，並本能地抗拒任何形式的「改變」。您可能會將「傳統」或「規則」當作抵擋焦慮的盾牌，變得僵化且缺乏彈性。</p>
<p>在最壞的情況下，您的保護欲會轉變為「防衛性」，將所有「不同」的人事物都視為潛在的「威脅」。您害怕犯錯，因此寧願不做，也不願嘗試。您需要學習，不是所有未知都是危險，過度的守護有時反而是扼殺了生命力。</p>`,
                suggestion: `<h3>靈性揚升與香氛建議</h3>
<p>您的靈魂功課，是從「防衛 (Defend)」昇華為「祝福 (Bless)」。您需要學習，真正的安全感並非來自「緊抓不放」，而是來自「內在的信任」。您的揚升之路始于「接納改變」與「釋放焦慮」。</p>
<ul>
    <li><b>小步嘗試：</b> 從小處開始接納「不確定性」。允許計畫被打亂，並觀察自己的情緒反應，練習告訴自己：「一切都會沒事的。」</li>
    <li><b>信任他人：</b> 練習將責任「交託」給他人，相信他們有能力處理好，即使他們的方式與您不同。</li>
    <li><b>香氛藝術療法：</b> 您的草本調（如薰衣草、羅勒）是您安定的來源。當您感到焦慮或抗拒時，請在您的香氛藝術中，引入「自由」的能量。強烈建議您使用<b>「03 創意者」</b>的自由金光色（如佛手柑、檸檬），或<b>「05 冒險者」</b>的奔放蒼穹色（如薄荷）。這能幫助您打開固有的框架，在您堅固的城牆上開一扇窗，讓陽光與新鮮空氣流進來。這能幫助您從「焦慮的守衛」昇華為「給予祝福的守望者」。</li>
</ul>`
            },
            "explorer": {
                title: "07 探索者 (Explorer)",
                strength: `<h3>主要優勢：真理的追尋者</h3>
<p>您的人格核心關鍵字是「智慧」與「深潛」。您是一個獨立而敏銳的靈魂，不滿足於世界的表象，天生就帶著一股「追尋真理」的渴望。您喜歡獨處，享受沉浸在思考、研究或靈性探索中。您是天生的觀察者與分析者，擁有看透事物本質的敏銳洞察力。您的樹脂木質調能量，如同古老寺廟中的薰香，深沉、神秘，能引人進入內在的平靜與奧秘之中。</p>
<p>在工作中，您是專家型的學者或策略家。您不喜歡被打擾，但只要給您足夠的空間與時間，您就能深入挖掘問題的核心，提出極具深度的見解。在人際關係中，您是「靈魂伴侶」型的朋友，您不熱衷於膚淺的社交，但渴望能與少數人進行深刻的心靈交流。</p>`,
                challenge: `<h3>潛在陰影：與世隔絕</h3>
<p>「探索者」最大的靈性課題，在於「連結」與「行動」。您對內在世界的過度沉迷，有時會讓您與現實生活脫節。您可能會顯得孤高、冷漠，或難以親近，彷彿與世界隔著一層紗。您擅長「思考」，卻可能拙於「行動」；您擁有很多「知識」，卻可能缺乏「體驗」。</p>
<p>您害怕自己的內在空間被「庸俗」的凡人俗事所侵擾，因此選擇退縮。但過度的退縮會導致「知識癱瘓」，您滿腹的智慧無法為世界所用，也無法在現實中得到驗證。您需要學習，真正的靈性，是在「出世」的智慧與「入世」的實踐中找到平衡。</p>`,
                suggestion: `<h3>靈性揚升與香氛建議</h3>
<p>您的靈魂功課，是從「隱士 (Hermit)」昇華為「智者 (Sage)」。您需要學習，如何將您深奧的智慧，用「人」的語言分享出來。您的揚升之路始于「分享」與「入世」。</p>
<ul>
    <li><b>走出洞穴：</b> 強迫自己定期參與「非靈性」的社交活動。練習用簡單的語言，將您的洞見分享給「麻瓜」。</li>
    <li><b>採取行動：</b> 將您的一個「理論」付諸實踐。如果您研究了園藝，就去種花；如果您研究了溝通，就去和人聊天。</li>
    <li><b>香氛藝術療法：</b> 您的樹脂木質調（如乳香、沒藥）是您深潛的管道。當您感到與世界脫節時，請在您的香氛藝術中，加入「連結」的能量。強烈建議您使用<b>「02 合作者」</b>的溫暖橙曦色與白花香調（如茉莉、依蘭），這能為您的智慧注入「溫度」；或使用<b>「05 冒險者」</b>的奔放清新調（如杜松、萊姆），推動您將智慧帶入行動。這能幫助您從「孤高的學者」昇華為「在人間行走的智者」。</li>
</ul>`
            },
            "achiever": {
                title: "08 成就者 (Achiever)",
                strength: `<h3>主要優勢：高效的驅動者</h3>
<p>您的人格核心關鍵字是「目標」與「效率」。您是天生的「驅動者」，充滿活力與競爭力。您享受「達成目標」的快感，並能為此付出驚人的努力。您是結果導向的，擅長將遠大的目標切割成可執行的步驟，並以最高效率完成。您的木質草本辛香調能量，如同鎖定目標的彗星，專注、耀眼且充滿動能。</p>
<p>在工作中，您是明星員工或高效的管理者。您是「多工處理」的高手，總能按時甚至提前完成任務。您的存在就是「績效」的保證。在人際關係中，您也會將「效率」帶入，您喜歡有「品質」的相處，並會努力讓自己和伴侶變得「更好」。您是激勵他人上進的榜樣。</p>`,
                challenge: `<h3>潛在陰影：價值的焦慮</h3>
<p>「成就者」最大的靈性課題，在於「存在」與「過程」。您對「結果」的極度專注，使您容易將「自我價值」與「外在成就」完全劃上等號。這導致您陷入一個永無止境的「證明循環」—— 必須不斷地達成下一個目標，才能感覺到自己「夠好」。您害怕「失敗」，更害怕「停下來」。</p>
<p>這使您難以真正享受「過程」與「當下」。您總是在奔跑，犧牲了健康、關係與內在的平靜。您可能會變得急躁、缺乏耐心，並用「效率」的標準去評判他人。您是「人類的實踐者 (Human Doing)」，卻忘記了如何「成為人類 (Human Being)」。</p>`,
                suggestion: `<h3>靈性揚升與香氛建議</h3>
<p>您的靈魂功課，是從「做事 (Doing)」昇華為「存在 (Being)」。您需要學習，您的價值與生俱來，無需任何外在成就來證明。您的揚升之路始于「放鬆」與「享受當下」。</p>
<ul>
    <li><b>安排「無所事事」：</b> 在您的行事曆上，刻意安排出「空白」時段，不帶任何目的性地去散步、發呆或品茶。</li>
    <li><b>慶祝過程：</b> 在專案進行中，為「過程」中的小進展慶祝，而不只是等待最終的結果。</li>
    <li><b>香氛藝術療法：</b> 您的草本辛香調（如迷迭香、羅勒）是您專注的來源。當您需要「慢下來」時，請在您的香氛藝術中，注入「放鬆」與「感性」的能量。強烈建議您使用<b>「09 理想者」</b>的浪漫月光色與花香調（如玫瑰、天竺葵），這能喚醒您的感性面；或使用<b>「12 靈魂導師」</b>的聖光色東方調（如檀香、依蘭），幫助您連結內在的平靜與智慧。這能幫助您從「焦慮的工作狂」昇華為「享受生命的實踐家」。</li>
</ul>`
            },
            "idealist": {
                title: "09 理想者 (Idealist)",
                strength: `<h3>主要優勢：純粹的夢想家</h3>
<p>您的人格核心關鍵字是「信念」與「希望」。您是降臨人間的純粹靈魂，心中懷抱著對「美好世界」的堅定信念。您浪漫、富有同情心，並能輕易地看見他人內在的光芒。您是天生的療癒者，您的存在本身就能給予他人希望與安慰。您的花香柑苔調能量，如同雨後潔淨的月光，空靈、純粹，散發著療癒與安撫的氣息。</p>
<p>在工作中，您是組織的「靈魂」與「願景啟發者」。您重視「意義」大於「利益」，適合從事教育、諮商、藝術或慈善事業。在人際關係中，您是真誠而浪漫的伴侶，您渴望深度的靈魂連結，並會用盡全力去相信與支持您所愛的人。</p>`,
                challenge: `<h3>潛在陰影：幻滅的痛苦</h3>
<p>「理想者」最大的靈性課題，在於「現實」與「接納」。您對「完美」的極度執著，使您在面對現實世界（與人性）的殘酷與不完美時，會感到極度的痛苦與幻滅。您容易將人事物過度美化，當現實不如預期時，您會比任何人都更深地墜入失望的深淵。</p>
<p>為了保護那份純粹，您可能會選擇「逃避」—— 退縮到自己的想像世界中，不願面對現實的粗糙。您可能會變得「不切實際」，難以處理日常的瑣事與衝突。您害怕「醜陋」，因此不願去看見自己或他人內在的陰影。</p>`,
                suggestion: `<h3>靈性揚升與香氛建議</h3>
<p>您的靈魂功課，是從「空想 (Fantasy)」昇華為「願景 (Vision)」。您需要學習，真正的美好並非「沒有黑暗」，而是「黑暗與光明並存」。您的揚升之路始于「接地」與「接納不完美」。</p>
<ul>
    <li><b>擁抱陰影：</b> 練習在您討厭的人事物中，找到一點「可取之處」或「值得學習」的地方。</li>
    <li><b>務實行動：</b> 與其抱怨世界不完美，不如選擇一件您能做的小事去「改善」它，例如做環保、關心一位朋友。</li>
    <li><b>香氛藝術療法：</b> 您的花香柑苔調（如玫瑰、佛手柑）是您連結美的天賦。當您感到「飄」在空中時，請在您的香氛藝術中，注入「大地」的能量。強烈建議您使用<b>「04 實踐者」</b>的務實翠岩色（如絲柏、雪松），或<b>「11 建築大師」</b>的結構大地色（如岩蘭草、廣藿香）。這能為您的理想提供紮根的土壤，幫助您在不完美的現實中，一步步地去「創造」您心中的美好，從「不切實際的夢想家」昇華為「在人間創造天堂的療癒者」。</li>
</ul>`
            },
            "inspirator": {
                title: "10 靈感者 (Inspirator)",
                strength: `<h3>主要優勢：靈性的燈塔</h3>
<p>您的人格核心關鍵字是「啟迪」與「連結高我」。您是天生的靈性管道與啟發者，您的意識敏銳，能輕易地穿透事物的表象，連結到更宏大的宇宙智慧與無限的可能性。您如同燈塔，您的隻字片語或一個不經意的點子，往往能為他人帶來醍醐灌頂的洞見。您的麝香琥珀東方調能量，深遠、溫暖而神秘，能引發他人的靈魂共振，喚醒他們內在的神性。</p>
<p>在工作中，您是「願景的給予者」與「靈魂導師」。您不適合處理繁瑣的行政事務，但您在提供創意策略、心靈輔導或藝術表達方面無人能及。在人際關係中，您散發著一股「無限」的氣質，讓人們在您身邊感到平靜，並願意探索更深層的生命意義。</p>`,
                challenge: `<h3>潛在陰影：與世脫節</h3>
<p>「靈感者」最大的靈性課題，在於「紮根」與「實踐」。您常處於高頻的靈感狀態，但這也使您容易忽略「物質世界」的現實。您可能對金錢、時間管理、身體健康等「世俗」事務感到困難或不屑一顧。您容易「飄在空中」，在生活中顯得不切實際、健忘或難以捉摸。</p>
<p>您的靈感如果沒有在現實中「顯化」，它就只是一種能量的流動，無法真正服務他人或支持自己。您需要學習，身體是靈魂的殿堂，物質世界是靈性實踐的道場。真正的靈性是「天人合一」，而非「棄地升天」。</p>`,
                suggestion: `<h3>靈性揚升與香氛建議</h3>
<p>您的靈魂功課，是從「傳訊 (Channel)」昇華為「顯化 (Manifest)」。您需要學習，如何將來自高維的無限靈感，轉化為地球上的具體成果。您的揚升之路始于「接地」與「身體力行」。</p>
<ul>
    <li><b>連結大地：</b> 每天花時間赤腳踩土地、擁抱樹木，或從事園藝、烹飪等「接地」的活動。</li>
    <li><b>重視身體：</b> 練習透過瑜珈、舞蹈或運動來「感受」您的身體，而非只是「使用」它。</li>
    <li><b>香氛藝術療法：</b> 您的麝香琥珀調（如琥珀、檀香）是您連結宇宙的橋樑。當您需要「接地」時，請在您的香氛藝術中，大量使用「大地」的能量。強烈建議您使用<b>「11 建築大師」</b>的結構大地色（如岩蘭草、廣藿香），或<b>「04 實踐者」</b>的務實柑苔調（如絲柏）。這能幫助您建立一個強大的「錨」，將靈感穩固地帶到地球上，從「飄渺的傳訊者」昇華為「在生活中顯化奇蹟的導師」。</li>
</ul>`
            },
            "architect": {
                title: "11 建築大師 (Architect)",
                strength: `<h3>主要優勢：秩序的建構者</h3>
<p>您的人格核心關鍵字是「結構」與「系統」。您是天生的「建構者」，擁有將混亂轉化為有序的非凡才能。您的思維極具邏輯性與系統性，擅長分析、規劃並建立可靠的框架。您重視效率、穩固與長遠的佈局。您的綠意柑苔調能量，如同穩固的大地，承載並滋養著萬物，是一切發展的基礎。</p>
<p>在工作中，您是絕佳的系統分析師、工程師或專案經理。您能設計出高效的流程，並確保其穩定運行。您是組織的「骨架」，支撐著一切的運作。在生活中，您也會將一切安排得井井有條，是家庭中那個「可靠」的存在。您透過建立穩定的環境來表達您的關愛。</p>`,
                challenge: `<h3>潛在陰影：僵化的牢籠</h3>
<p>「建築大師」最大的靈性課題，在於「彈性」與「人性」。您對「秩序」和「規則」的極度依賴，有時會讓您變得僵化、缺乏想像力，並試圖將一切都納入您的「系統」中，包括無法被系統化的「情感」。您害怕「混亂」，因此可能壓抑了自己或他人的創意與情感流動。</p>
<p>您建立的「系統」可能在不知不覺中變成了「牢籠」，使您失去了適應變化的能力。您可能過於「理性」，而忽略了「感性」的需求，顯得不近人情。您需要學習，生命本身就是有機且混亂的，最完美的系統，是能為「生命力」服務的系統。</p>`,
                suggestion: `<h3>靈性揚升與香氛建議</h3>
<p>您的靈魂功課，是從「規範 (Control)」昇華為「支持 (Support)」。您需要學習，您的天賦是為了「支持」生命，而非「框住」生命。您的揚升之路始于擁抱「流動」與「感性」。</p>
<ul>
    <li><b>保留彈性：</b> 在您完美的計畫中，刻意保留 20% 的「彈性」或「混亂」空間，並觀察它帶來的「驚喜」。</li>
    <li><b>重視感受：</b> 在做決定時，除了「邏輯」分析外，也問問自己：「我的『感覺』如何？」</li>
    <li><b>香氛藝術療法：</b> 您的綠意柑苔調（如岩蘭草、橡木苔）是您穩固的根基。當您需要「彈性」時，請在您的香氛藝術中，注入「創意」與「流動」的能量。強烈建議您使用<b>「03 創意者」</b>的靈動柑橘花香調（如佛手柑、橙花），或<b>「09 理想者」</b>的浪漫花香調（如玫瑰）。這能幫助您在穩固的結構上，增添生命的活力與色彩，從「僵化的規範者」昇華為「支持生命流動的宏觀創造者」。</li>
</ul>`
            },
            "mentor": {
                title: "12 靈魂導師 (Soul Mentor)",
                strength: `<h3>主要優勢：智慧的引路人</h3>
<p>您的人格核心關鍵字是「智慧」與「慈悲」。您是古老的靈魂，天生就帶著一股穩定、包容且聖潔的能量。您如同智慧的引路人，人們會不自覺地被您吸引，向您尋求建議與安慰。您是絕佳的傾聽者，充滿同理心，並能給予超越個人情感的、充滿智慧的回應。您的花香東方調能量，如同溫暖的聖光，無條件地歡迎並療癒一切來到您面前的靈魂。</p>
<p>在工作中，您是天生的諮商師、教師、人資或療癒者。您能輕易地安撫焦慮的團隊，並啟發他人看見自己更高的潛能。在人際關係中，您是那個「靈魂的避風港」，是所有人的心靈支柱。</p>`,
                challenge: `<h3>潛在陰影：承載的界線</h3>
<p>「靈魂導師」最大的靈性課題，在於「界線」與「賦權」。您的慈悲心使您難以對他人的痛苦置之不理，這也使您極易承載過多「不屬於您」的情緒能量與責任。您容易陷入「拯救者」的劇本，試圖「背負」他人的課題，最終導致自己能量耗竭。</p>
<p>您害怕「自私」，因此不敢拒絕，也忘了照顧自己。您需要深刻地理解，真正的慈悲並非「替他人受苦」，而是「相信並賦權他人有能力走過自己的路」。您必須學會劃清「您的課題」與「他人的課題」之間的界線。</p>`,
                suggestion: `<h3>靈性揚升與香氛建議</h3>
<p>您的靈魂功課，是從「拯救 (Rescue)」昇華為「賦權 (Empower)」。您需要學習，如何成為一個「清晰的鏡子」，而非「吸滿情緒的海綿」。您的揚升之路始于「自我關懷」與「劃清界線」。</p>
<ul>
    <li><b>能量淨化：</b> 每天結束時，進行一個「切斷能量索」的冥想，將不屬於您的能量歸還給大地。</li>
    <li><b>學會「不給建議」：</b> 當他人向您傾訴時，練習只是「傾聽」與「提問」，而非急於「給出答案」或「出手相救」。</li>
    <li><b>香氛藝術療法：</b> 您的花香東方調（如檀香、依蘭、茉莉）是您慈悲的展現。當您感到能量耗竭時，請在您的香氛藝術中，加入「界線」與「力量」的能量。強烈建議您使用<b>「01 領導者」</b>的赤紅色木質辛香調（如雪松、薑），這能幫助您建立清晰的「能量邊界」；或使用<b>「08 成就者」</b>的鎏金色，提醒您「照顧自己」也是一項重要的「成就」。這能幫助您從「疲憊的承擔者」昇華為「賦權他人的智慧燈塔」。</li>
</ul>`
            }
        };

        // ======== 2. 抓取 DOM 元素 (新增 Report 按鈕) ========
        const elements = {
            userInfoModal: document.getElementById('user-info-modal'),
            userInfoForm: document.getElementById('user-info-form'),
            mainContent: document.getElementById('main-content'),
            userName: document.getElementById('user-name'),
            userPhone: document.getElementById('user-phone'),
            selects: { top: document.getElementById('select-top'), mid: document.getElementById('select-mid'), base: document.getElementById('select-base') },
            sliders: { top: document.getElementById('slider-top'), mid: document.getElementById('slider-mid'), base: document.getElementById('slider-base') },
            values: { top: document.getElementById('value-top'), mid: document.getElementById('value-mid'), base: document.getElementById('value-base') },
            params: { color: document.getElementById('slider-color'), spray: document.getElementById('slider-spray'), halo: document.getElementById('slider-halo') },
            generateBtn: document.getElementById('generate-btn'),
            artCanvas: document.getElementById('art-canvas'),
            startRecordBtn: document.getElementById('start-record-btn'),
            stopRecordBtn: document.getElementById('stop-record-btn'),
            screenshotBtn: document.getElementById('screenshot-btn'),
            infoText: document.getElementById('recorder-info'),
            audioPlayer: document.getElementById('bg-music'),
            inquiryForm: document.getElementById('inquiry-form'),
            inquiryName: document.getElementById('inquiry-name'),
            inquiryPhone: document.getElementById('inquiry-phone'),
            inquiryTitleContainer: document.getElementById('inquiry-title-container'),
            inquiryMessage: document.getElementById('inquiry-message'),

            // 報告相關
            reportBtn: document.getElementById('report-btn'),
            reportTemplate: document.getElementById('report-template'),
            reportUserName: document.getElementById('report-user-name'),
            reportFormula: document.getElementById('report-formula'),
            reportDate: document.getElementById('report-date'),
            reportSynergy: document.getElementById('report-synergy'), // 總結
            reportContent: document.getElementById('report-content'), // 細節
            reportRecipe: document.getElementById('report-recipe')  // 配方
        };
        
        // Canvas (不變)
        const canvas = elements.artCanvas;
        const ctx = canvas.getContext('2d');
        canvas.width = 500;
        canvas.height = 500;

        // 系統變數 (不變)
        let particlesArray = [];
        let animationFrameId = null;
        let mediaRecorder;
        let recordedChunks = [];
        let videoSettings = {};
        let userInfo = {};

        // (下拉選單和拉桿的陣列，不變)
        const allSelects = [elements.selects.top, elements.selects.mid, elements.selects.base];
        const allSliders = [elements.sliders.top, elements.sliders.mid, elements.sliders.base];
        const allValues = [elements.values.top, elements.values.mid, elements.values.base];

        // ======== 3. 核心邏輯 (邏輯 A, B, C 不變) ========
        function populateSelects() {
            let optionsHtml = '';
            personalityData.forEach(p => {
                optionsHtml += `<option value="${p.id}">${p.name}</option>`;
            });
            allSelects.forEach((select, index) => {
                select.innerHTML = optionsHtml;
                select.selectedIndex = index; 
            });
        }
        function handleDropdownChange() {
            const selectedValues = allSelects.map(select => select.value);
            allSelects.forEach(select => {
                Array.from(select.options).forEach(option => {
                    const isSelectedElsewhere = selectedValues.includes(option.value);
                    const isSelf = option.value === select.value;
                    option.disabled = (isSelectedElsewhere && !isSelf);
                });
            });
        }
        function handleSliderChange(changedSlider) {
            let total = 0;
            allSliders.forEach(slider => total += parseInt(slider.value));
            let excess = total - 100;
            if (excess > 0) {
                const otherSliders = allSliders.filter(s => s !== changedSlider);
                otherSliders.sort((a, b) => parseInt(b.value) - parseInt(a.value));
                for (let slider of otherSliders) {
                    if (excess === 0) break;
                    let currentValue = parseInt(slider.value);
                    let reduction = Math.min(currentValue, excess);
                    slider.value = currentValue - reduction;
                    excess -= reduction;
                }
            }
            total = 0;
            allSliders.forEach(slider => total += parseInt(slider.value));
            let deficit = 100 - total;
            if (deficit > 0) {
                const otherSlider = allSliders.find(s => s !== changedSlider);
                otherSlider.value = parseInt(otherSlider.value) + deficit;
            }
            allSliders.forEach((slider, index) => {
                allValues[index].textContent = `${slider.value}%`;
            });
        }
        
        // ======== 4. 粒子系統邏輯 (不變) ========
        class Particle {
            constructor(x, y, color, baseOpacity) {
                this.x = x; this.y = y; this.color = color;
                this.size = Math.random() * 3 + 1;
                this.opacity = (Math.random() * 0.5 + 0.5) * (baseOpacity / 200);
                this.vx = (Math.random() - 0.5) * 2;
                this.vy = (Math.random() - 0.5) * 2;
                this.life = 1;
                this.decay = Math.random() * 0.01 + 0.005;
            }
            update() {
                this.x += this.vx; this.y += this.vy; this.life -= this.decay;
                if (this.life <= 0 || this.x < 0 || this.x > canvas.width || this.y < 0 || this.y > canvas.height) {
                    this.reset();
                }
            }
            draw() {
                ctx.beginPath();
                ctx.globalAlpha = Math.max(0, this.life * this.opacity);
                ctx.fillStyle = this.color;
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
            reset() {
                this.x = canvas.width / 2; this.y = canvas.height / 2;
                this.vx = (Math.random() - 0.5) * 2;
                this.vy = (Math.random() - 0.5) * 2;
                this.life = 1;
            }
        }
        function generateArt() {
            if (animationFrameId) { cancelAnimationFrame(animationFrameId); }
            particlesArray = [];
            const settings = {
                personalities: [
                    { id: elements.selects.top.value, percent: parseInt(elements.sliders.top.value) },
                    { id: elements.selects.mid.value, percent: parseInt(elements.sliders.mid.value) },
                    { id: elements.selects.base.value, percent: parseInt(elements.sliders.base.value) }
                ],
                baseOpacity: parseInt(elements.params.color.value),
                particleCount: parseInt(elements.params.spray.value) * 100,
                halo: parseInt(elements.params.halo.value) 
            };
            for (let i = 0; i < settings.particleCount; i++) {
                const rand = Math.random() * 100;
                let personality;
                if (rand < settings.personalities[0].percent) { personality = settings.personalities[0]; }
                else if (rand < settings.personalities[0].percent + settings.personalities[1].percent) { personality = settings.personalities[1]; }
                else { personality = settings.personalities[2]; }
                const color = personalityData.find(p => p.id === personality.id).color;
                particlesArray.push(new Particle(canvas.width / 2, canvas.height / 2, color, settings.baseOpacity));
            }
            animate(settings);
        }
        function animate(settings) {
            ctx.globalAlpha = 0.1; ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.shadowBlur = settings.halo / 2;
            for (let i = 0; i < particlesArray.length; i++) {
                ctx.shadowColor = particlesArray[i].color;
                particlesArray[i].update();
                particlesArray[i].draw();
            }
            ctx.shadowBlur = 0;
            animationFrameId = requestAnimationFrame(() => animate(settings));
        }

        // ======== 5. 錄影與截圖功能 (不變) ========
        function startRecording() {
            // ... (程式碼不變)
            console.log("開始錄影...");
            recordedChunks = [];
            if (MediaRecorder.isTypeSupported('video/mp4; codecs=avc1')) {
                videoSettings.mimeType = 'video/mp4; codecs=avc1';
                videoSettings.fileExtension = 'mp4';
                elements.infoText.innerHTML = "ℹ️ 您的瀏覽器支援MP4。正在錄製為 <strong>.mp4</strong> 檔案。";
            } else {
                videoSettings.mimeType = 'video/webm; codecs=vp9';
                videoSettings.fileExtension = 'webm';
                elements.infoText.innerHTML = "ℹ️ 您的瀏覽器不支援MP4，已錄製為 <strong>.webm</strong>。<br>推薦使用 <a href='https://www.videolan.org/vlc/' target='_blank'>VLC Player</a> 播放。";
            }
            const stream = canvas.captureStream(30);
            try { mediaRecorder = new MediaRecorder(stream, { mimeType: videoSettings.mimeType }); }
            catch (e) { console.error("MediaRecorder 初始化失敗:", e); elements.infoText.innerHTML = "❌ 錄影初始化失敗。"; return; }
            mediaRecorder.ondataavailable = function(event) { if (event.data.size > 0) { recordedChunks.push(event.data); } };
            mediaRecorder.onstop = saveRecording;
            mediaRecorder.start();
            elements.startRecordBtn.disabled = true;
            elements.stopRecordBtn.disabled = false;
            elements.startRecordBtn.style.backgroundColor = '#444';
            elements.stopRecordBtn.style.backgroundColor = '#DC3545';
        }
        function stopRecording() {
            // ... (程式碼不變)
            console.log("停止錄影...");
            if (mediaRecorder) { mediaRecorder.stop(); }
            elements.startRecordBtn.disabled = false;
            elements.stopRecordBtn.disabled = true;
            elements.startRecordBtn.style.backgroundColor = '#DC3545';
            elements.stopRecordBtn.style.backgroundColor = '#444';
            elements.infoText.innerHTML = "";
        }
        function saveRecording() {
            // ... (程式碼不變)
            console.log("儲存錄影中...");
            if (recordedChunks.length === 0) { return; }
            const blob = new Blob(recordedChunks, { type: videoSettings.mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            document.body.appendChild(a);
            a.style = "display: none"; a.href = url;
            a.download = `香氛人格_錄影.${videoSettings.fileExtension}`; 
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
        }
        function takeScreenshot() {
            // ... (程式碼不變)
            console.log("截圖...");
            const dataURL = canvas.toDataURL("image/png");
            const a = document.createElement("a");
            document.body.appendChild(a);
            a.style = "display: none"; a.href = dataURL;
            a.download = "香氛人格_截圖.png";
            a.click();
            document.body.removeChild(a);
        }

        // ======== 6. 訪客登錄、音樂、洽詢 功能 (使用 Netlify 提交) ========

        async function handleUserFormSubmit(event) {
            // ... (程式碼不變)
            event.preventDefault();
            const formData = new FormData(elements.userInfoForm);
            try {
                await fetch("/", {
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    body: new URLSearchParams(formData).toString()
                });
                console.log("訪客登錄資料已提交至 Netlify");
                userInfo.name = elements.userName.value;
                userInfo.phone = elements.userPhone.value;
                userInfo.title = document.querySelector('input[name="user-title"]:checked').value;
                elements.inquiryName.value = userInfo.name;
                elements.inquiryPhone.value = userInfo.phone;
                elements.inquiryTitleContainer.innerHTML = `
                    <label><input type="radio" name="inquiry-title" value="先生" ${userInfo.title === '先生' ? 'checked' : ''} disabled> 先生</label>
                    <label><input type="radio" name="inquiry-title" value="小姐" ${userInfo.title === '小姐' ? 'checked' : ''} disabled> 小姐</label>
                `;
                elements.userInfoModal.style.display = 'none';
                elements.mainContent.style.display = 'flex';
                populateSelects();
                handleDropdownChange();
                generateArt(); 
                updateMusic();
                elements.audioPlayer.play().catch(e => console.warn("音樂自動播放被阻擋:", e));
            } catch (error) {
                console.error("Netlify 登錄表單提交失敗:", error);
                alert("抱歉，登錄時發生錯誤，請重新整理頁面。");
            }
        }
        
        function updateMusic() {
            // ... (程式碼不變)
            const selectedId = elements.selects.top.value;
            const personality = personalityData.find(p => p.id === selectedId);
            if (personality && personality.musicUrl) {
                console.log("播放音樂:", personality.musicUrl);
                elements.audioPlayer.src = personality.musicUrl;
                elements.audioPlayer.play().catch(e => console.warn("音樂自動播放被阻擋:", e));
            }
        }
        
        async function handleInquirySubmit(event) {
            // ... (程式碼不變)
            event.preventDefault(); 
            const formData = new FormData(elements.inquiryForm);
            formData.append('inquiry-title', userInfo.title); 
            try {
                await fetch("/", {
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    body: new URLSearchParams(formData).toString()
                });
                console.log("洽詢表單已提交至 Netlify");
                alert("感謝您的留言，我們已成功收到您的洽詢！");
                elements.inquiryMessage.value = ""; 
            } catch (error) {
                console.error("Netlify 洽詢表單提交失敗:", error);
                alert("抱歉，訊息發送失敗，請稍後再試。");
            }
        }

        /*
         * 【重大升級 2/3】
         * 全新的 AI 協同分析引擎 (Synergy Engine)
        */
        function getSynergyAnalysis(top, mid, base) {
            let analysis = "<h2>AI 協同分析總結</h2>";
            
            // 找出主導、輔助、潛在特質
            let notes = [top, mid, base];
            notes.sort((a, b) => b.percent - a.percent); // 依百分比排序
            let dominant = notes[0];
            let support = notes[1];
            let subconscious = notes[2];

            // 情況一：一個特質佔據絕對主導 (大於 50%)
            if (dominant.percent > 50) {
                analysis += `
<p>親愛的 ${userInfo.name}，您的人格結構非常清晰且強大。您有超過一半的能量 (<strong>${dominant.percent}%</strong>) 由「<strong>${dominant.insight.title}</strong>」所主導。這代表 ${dominant.type} 是您展現給世界的主要面貌，是您決策與行動的核心驅動力。</p>
<p>您的「<strong>${support.insight.title}</strong>」(${support.percent}%) 扮演著重要的輔助角色，它在您需要時提供支援。而「<strong>${subconscious.insight.title}</strong>」(${subconscious.percent}%) 則是您較為潛在、或需要在靈性上多加整合的能量。</p>
<p><b>您的核心課題：</b>在於覺察您「${dominant.insight.title}」的「潛在陰影」。當這個特質過度展現時，您必須有意識地去啟動您的「${support.insight.title}」與「${subconscious.insight.title}」能量來平衡。例如，${dominant.insight.suggestion}</p>
<p>請專注於整合您的「${subconscious.insight.title}」特質，這將是您人格全面昇華的關鍵鑰匙。</p>
                `;
            }
            // 情況二：兩個特質非常接近 (例如 45-45-10)
            else if (dominant.percent - support.percent < 10 && subconscious.percent < 20) {
                 analysis += `
<p>親愛的 ${userInfo.name}，您的人格結構呈現一種強烈的「雙元動力」。您的「<strong>${dominant.insight.title}</strong>」(${dominant.percent}%) 與「<strong>${support.insight.title}</strong>」(${support.percent}%) 旗鼓相當，共同主導著您的人格展現。</p>
<p>這可能代表您時常感到一種「內在的拉扯」。例如，您可能同時擁有 ${dominant.insight.title} 的特質 A 和 ${support.insight.title} 的特質 B。您的人生無時無刻不在學習如何讓這兩種強大的能量和諧共舞，而非彼此衝突。</p>
<p><b>您的核心課題：</b>在於「整合」而非「選擇」。您不需要在兩者之間擇一，而是要找到一條能同時發揮兩者優勢的中庸之道。您的「<strong>${subconscious.insight.title}</strong>」(${subconscious.percent}%) 特質雖然佔比最低，卻是調和這場內在拉扯的「關鍵解方」。${subconscious.insight.suggestion}</p>
<p>請嘗試在生活中，刻意地運用「${subconscious.insight.title}」的智慧，它將成為您那兩股強大能量之間的完美橋樑。</p>
                `;
            }
            // 情況三：三者均衡 (例如 34-33-33)
            else {
                 analysis += `
<p>親愛的 ${userInfo.name}，您擁有一個極為罕見且均衡的「三位一體」人格結構。您的前調 (${top.percent}%)、中調 (${mid.percent}%) 與後調 (${base.percent}%) 能量幾乎均等，代表您是一個面向豐富、適應力極強的人。</p>
<p>您就像一個「人格的調色盤」，可以根據不同的情境，自由地調用「<strong>${top.insight.title}</strong>」的動力、「<strong>${mid.insight.title}</strong>」的情感與「<strong>${base.insight.title}</strong>」的穩固。您是天生的整合者。</p>
<p><b>您的核心課題：</b>在於「清晰的自我認同」。擁有多元的天賦，有時反而會讓您感到「我到底是誰？」的困惑。您可能在不同角色間切換自如，卻缺乏一個恆定的「核心」。</p>
<p>您的靈性之路，不在於「補強」，而在於「融合」。您需要將這三股能量有意識地融合成一個「專屬於您」的獨特版本。${top.insight.suggestion} 這將幫助您在多元中找到統一。</p>
                `;
            }

            return analysis;
        }

        /*
         * 【重大升級 3/3】
         * 產生 PDF 報告的函數 (已重寫)
        */
        function generatePDFReport() {
            console.log("開始產生 PDF 報告 (v2.0 深度版)...");
            elements.reportBtn.disabled = true;
            elements.reportBtn.textContent = "報告生成中，請稍候...";

            // 1. 獲取三種人格的資料
            const topNote = {
                id: elements.selects.top.value,
                name: elements.selects.top.options[elements.selects.top.selectedIndex].text,
                percent: parseInt(elements.sliders.top.value),
                insight: personalityInsights[elements.selects.top.value],
                type: '前調 (Top Note)'
            };
            const midNote = {
                id: elements.selects.mid.value,
                name: elements.selects.mid.options[elements.selects.mid.selectedIndex].text,
                percent: parseInt(elements.sliders.mid.value),
                insight: personalityInsights[elements.selects.mid.value],
                type: '中調 (Middle Note)'
            };
            const baseNote = {
                id: elements.selects.base.value,
                name: elements.selects.base.options[elements.selects.base.selectedIndex].text,
                percent: parseInt(elements.sliders.base.value),
                insight: personalityInsights[elements.selects.base.value],
                type: '後調 (Base Note)'
            };

            // 2. 填入報告模板的「表頭」
            elements.reportUserName.textContent = `${userInfo.name} ${userInfo.title}`;
            elements.reportFormula.textContent = `${topNote.percent}% ${topNote.insight.title} + ${midNote.percent}% ${midNote.insight.title} + ${baseNote.percent}% ${baseNote.insight.title}`;
            elements.reportDate.textContent = new Date().toLocaleDateString('zh-TW');

            // 3. 【全新】調用 AI 協同分析引擎
            const synergyHTML = getSynergyAnalysis(topNote, midNote, baseNote);
            elements.reportSynergy.innerHTML = synergyHTML;

            // 4. 動態組合報告的「深度分析細節」
            // 按照百分比排序，最重要的放最前面
            let notes = [topNote, midNote, baseNote];
            notes.sort((a, b) => b.percent - a.percent); 
            
            let contentHTML = `
                <h2>您的人格深度解析</h2>
                
                <h3>您的主導特質：${notes[0].insight.title} (${notes[0].percent}%)</h3>
                ${notes[0].insight.strength}
                ${notes[0].insight.challenge}
                ${notes[0].insight.suggestion}

                <h3>您的輔助特質：${notes[1].insight.title} (${notes[1].percent}%)</h3>
                ${notes[1].insight.strength}
                ${notes[1].insight.challenge}
                ${notes[1].insight.suggestion}

                <h3>您的潛在特質：${notes[2].insight.title} (${notes[2].percent}%)</h3>
                ${notes[2].insight.strength}
                ${notes[2].insight.challenge}
                ${notes[2].insight.suggestion}
            `;
            elements.reportContent.innerHTML = contentHTML;

            // 5. 【全新】產生專屬香氛配方
            let recipeHTML = `
                <h2>您的專屬香氛調配配方</h2>
                <div class="recipe-box">
                    <h3>您的個人靈性揚升配方</h3>
                    <p>這份配方是根據您獨特的 ${topNote.percent}%-${midNote.percent}%-${baseNote.percent}% 人格比例所調製。它能幫助您整合三股能量，在日常生活中活出您最高版本的潛能。</p>
                    <ul>
                        <li><strong>前調 (啟動)：</strong> ${topNote.percent} 滴 - ${topNote.name}</li>
                        <li><strong>中調 (和諧)：</strong> ${midNote.percent} 滴 - ${midNote.name}</li>
                        <li><strong>後調 (根基)：</strong> ${baseNote.percent} 滴 - ${baseNote.name}</li>
                    </ul>
                    <h3>使用建議</h3>
                    <p>您可以將此比例（例如 3 滴前調、3 滴中調、3 滴後調）用於：</p>
                    <ul>
                        <li><strong>空間擴香：</strong> 在您工作、冥想或休息的空間使用，創造一個支持您的人格協同運作的能量場。</li>
                        <li><strong>香氛藝術：</strong> 在您進行藝術創作（如繪畫、書寫）時使用此配方薰香，這能幫助您更深刻地連結並表達您的內在特質。</li>
                        <li><strong>個人香氛：</strong> 將此比例（總滴數 3-5 滴）加入 10ml 的植物基底油（如荷荷芭油或甜杏仁油）中，作為您的個人滾珠香氛油，在需要時塗抹於手腕或耳後。</li>
                    </ul>
                </div>
            `;
            elements.reportRecipe.innerHTML = recipeHTML;


            // 6. 使用 html2pdf.js 生成並下載 PDF
            const reportElement = elements.reportTemplate;
            reportElement.style.display = 'block'; 

            const opt = {
                margin:       0, // 邊界由 CSS padding 控制
                filename:     `${userInfo.name}_香氛人格報告_Pro.pdf`,
                image:        { type: 'jpeg', quality: 0.98 },
                html2canvas:  { scale: 2, useCORS: true }, 
                jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };

            html2pdf().from(reportElement).set(opt).save().then(() => {
                // 完成後恢復
                reportElement.style.display = 'none'; 
                elements.reportBtn.disabled = false;
                elements.reportBtn.textContent = "產生您的香氛人格報告";
                console.log("PDF 深度報告已成功生成並下載！");
            });
        }

        // ======== 7. 綁定事件監聽器 ========
        document.addEventListener('DOMContentLoaded', () => {
            
            elements.userInfoForm.addEventListener('submit', handleUserFormSubmit);
            elements.stopRecordBtn.disabled = true; 
            elements.infoText.innerHTML = "";
            
            allSelects.forEach(select => {
                select.addEventListener('change', handleDropdownChange);
            });
            allSliders.forEach(slider => {
                slider.addEventListener('input', () => handleSliderChange(slider));
            });
            elements.generateBtn.addEventListener('click', generateArt);
            
            elements.startRecordBtn.addEventListener('click', startRecording);
            elements.stopRecordBtn.addEventListener('click', stopRecording);
            elements.screenshotBtn.addEventListener('click', takeScreenshot);
            
            elements.selects.top.addEventListener('change', updateMusic);
            
            elements.inquiryForm.addEventListener('submit', handleInquirySubmit);

            // 綁定報告按鈕
            elements.reportBtn.addEventListener('click', generatePDFReport);
        });
    </script>
</body>
</html>
